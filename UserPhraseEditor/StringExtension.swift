// Copyright (c) 2021 and onwards The vChewing Project (MIT-NTL License).
/*
Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated
documentation files (the "Software"), to deal in the Software without restriction, including without limitation
the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and
to permit persons to whom the Software is furnished to do so, subject to the following conditions:

1. The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.

2. No trademark license is granted to use the trade names, trademarks, service marks, or product names of Contributor,
   except as required to fulfill notice requirements above.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED
TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL
THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

import Foundation

extension String {
    mutating func regReplace(pattern: String, replaceWith: String = "") {
        do {
            let regex = try NSRegularExpression(pattern: pattern, options: .caseInsensitive)
            let range = NSRange(location: 0, length: count)
            self = regex.stringByReplacingMatches(in: self, options: [], range: range, withTemplate: replaceWith)
        } catch { return }
    }
    mutating func formatConsolidate(HYPY2BPMF: Bool) {
        // Step 1: Consolidating formats per line.
        var arrData = self.components(separatedBy: "\n")
        var varLineData = ""
        var strProcessed = ""
        for lineData in arrData {
            varLineData = lineData
            varLineData.regReplace(pattern: "„ÄÄ", replaceWith: " ") // CJKWhiteSpace to ASCIISpace
            varLineData.regReplace(pattern: "¬†", replaceWith: " ") // NonBreakWhiteSpace to ASCIISpace
            varLineData.regReplace(pattern: "\\s+", replaceWith: " ") // Consolidating Consecutive Spaves
            varLineData.regReplace(pattern: "^\\s", replaceWith: "") // Trim Leading Space
            varLineData.regReplace(pattern: "\\s$", replaceWith: "") // Trim Trailing Space
            strProcessed += varLineData
            strProcessed += "\n"
        }
        
        if HYPY2BPMF {
            // Step 0: Convert HanyuPinyin to Bopomofo.
            arrData = strProcessed.components(separatedBy: "\n")
            strProcessed = "" // Reset its value
            for lineData in arrData {
                varLineData = lineData
                // Êº¢Ë™ûÊãºÈü≥ËΩâÊ≥®Èü≥ÔºåÂæóÂÖàÂæûÊúÄÈï∑ÁöÑÂèØËÉΩÁöÑÊãºÈü≥ÁµÑÂêàÈñãÂßãËΩâËµ∑Ôºå
                // ÈÄôÊ®£Á≠âËΩâÊèõÂà∞Êõ¥Áü≠ÁöÑÂèØËÉΩÁöÑÊº¢Ë™ûÊãºÈü≥ÁµÑÂêàÊôÇÂ∞±‰∏çÊúÉÂá∫ÈåØ„ÄÇ
                // ‰æùÊ≠§È°ûÊé®ÔºåËÅ≤Ë™øÊîæÂú®ÊúÄÂæå‰æÜËΩâÊèõ„ÄÇ
                varLineData.regReplace(pattern: "chuang", replaceWith: "„Ñî„Ñ®„Ñ§")
                varLineData.regReplace(pattern: "shuang", replaceWith: "„Ñï„Ñ®„Ñ§")
                varLineData.regReplace(pattern: "zhuang", replaceWith: "„Ñì„Ñ®„Ñ§")
                varLineData.regReplace(pattern: "chang", replaceWith: "„Ñî„Ñ§")
                varLineData.regReplace(pattern: "cheng", replaceWith: "„Ñî„Ñ•")
                varLineData.regReplace(pattern: "chong", replaceWith: "„Ñî„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "chuai", replaceWith: "„Ñî„Ñ®„Ñû")
                varLineData.regReplace(pattern: "chuan", replaceWith: "„Ñî„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "guang", replaceWith: "„Ñç„Ñ®„Ñ§")
                varLineData.regReplace(pattern: "huang", replaceWith: "„Ñè„Ñ®„Ñ§")
                varLineData.regReplace(pattern: "jiang", replaceWith: "„Ñê„Ñß„Ñ§")
                varLineData.regReplace(pattern: "jiong", replaceWith: "„Ñê„Ñ©„Ñ•")
                varLineData.regReplace(pattern: "kuang", replaceWith: "„Ñé„Ñ®„Ñ§")
                varLineData.regReplace(pattern: "liang", replaceWith: "„Ñå„Ñß„Ñ§")
                varLineData.regReplace(pattern: "niang", replaceWith: "„Ñã„Ñß„Ñ§")
                varLineData.regReplace(pattern: "qiang", replaceWith: "„Ñë„Ñß„Ñ§")
                varLineData.regReplace(pattern: "qiong", replaceWith: "„Ñë„Ñ©„Ñ•")
                varLineData.regReplace(pattern: "shang", replaceWith: "„Ñï„Ñ§")
                varLineData.regReplace(pattern: "sheng", replaceWith: "„Ñï„Ñ•")
                varLineData.regReplace(pattern: "shuai", replaceWith: "„Ñï„Ñ®„Ñû")
                varLineData.regReplace(pattern: "shuan", replaceWith: "„Ñï„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "xiang", replaceWith: "„Ñí„Ñß„Ñ§")
                varLineData.regReplace(pattern: "xiong", replaceWith: "„Ñí„Ñ©„Ñ•")
                varLineData.regReplace(pattern: "zhang", replaceWith: "„Ñì„Ñ§")
                varLineData.regReplace(pattern: "zheng", replaceWith: "„Ñì„Ñ•")
                varLineData.regReplace(pattern: "zhong", replaceWith: "„Ñì„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "zhuai", replaceWith: "„Ñì„Ñ®„Ñû")
                varLineData.regReplace(pattern: "zhuan", replaceWith: "„Ñì„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "bang", replaceWith: "„ÑÖ„Ñ§")
                varLineData.regReplace(pattern: "beng", replaceWith: "„ÑÖ„Ñ•")
                varLineData.regReplace(pattern: "bian", replaceWith: "„ÑÖ„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "biao", replaceWith: "„ÑÖ„Ñß„Ñ†")
                varLineData.regReplace(pattern: "bing", replaceWith: "„ÑÖ„Ñß„Ñ•")
                varLineData.regReplace(pattern: "cang", replaceWith: "„Ñò„Ñ§")
                varLineData.regReplace(pattern: "ceng", replaceWith: "„Ñò„Ñ•")
                varLineData.regReplace(pattern: "chai", replaceWith: "„Ñî„Ñû")
                varLineData.regReplace(pattern: "chan", replaceWith: "„Ñî„Ñ¢")
                varLineData.regReplace(pattern: "chao", replaceWith: "„Ñî„Ñ†")
                varLineData.regReplace(pattern: "chen", replaceWith: "„Ñî„Ñ£")
                varLineData.regReplace(pattern: "chou", replaceWith: "„Ñî„Ñ°")
                varLineData.regReplace(pattern: "chua", replaceWith: "„Ñî„Ñ®„Ñö")
                varLineData.regReplace(pattern: "chui", replaceWith: "„Ñî„Ñ®„Ñü")
                varLineData.regReplace(pattern: "chun", replaceWith: "„Ñî„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "chuo", replaceWith: "„Ñî„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "cong", replaceWith: "„Ñò„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "cuan", replaceWith: "„Ñò„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "dang", replaceWith: "„Ñâ„Ñ§")
                varLineData.regReplace(pattern: "deng", replaceWith: "„Ñâ„Ñ•")
                varLineData.regReplace(pattern: "dian", replaceWith: "„Ñâ„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "diao", replaceWith: "„Ñâ„Ñß„Ñ†")
                varLineData.regReplace(pattern: "ding", replaceWith: "„Ñâ„Ñß„Ñ•")
                varLineData.regReplace(pattern: "dong", replaceWith: "„Ñâ„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "duan", replaceWith: "„Ñâ„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "fang", replaceWith: "„Ñà„Ñ§")
                varLineData.regReplace(pattern: "feng", replaceWith: "„Ñà„Ñ•")
                varLineData.regReplace(pattern: "fiao", replaceWith: "„Ñà„Ñß„Ñ†")
                varLineData.regReplace(pattern: "fong", replaceWith: "„Ñà„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "gang", replaceWith: "„Ñç„Ñ§")
                varLineData.regReplace(pattern: "geng", replaceWith: "„Ñç„Ñ•")
                varLineData.regReplace(pattern: "giao", replaceWith: "„Ñç„Ñß„Ñ†")
                varLineData.regReplace(pattern: "gong", replaceWith: "„Ñç„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "guai", replaceWith: "„Ñç„Ñ®„Ñû")
                varLineData.regReplace(pattern: "guan", replaceWith: "„Ñç„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "hang", replaceWith: "„Ñè„Ñ§")
                varLineData.regReplace(pattern: "heng", replaceWith: "„Ñè„Ñ•")
                varLineData.regReplace(pattern: "hong", replaceWith: "„Ñè„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "huai", replaceWith: "„Ñè„Ñ®„Ñû")
                varLineData.regReplace(pattern: "huan", replaceWith: "„Ñè„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "jian", replaceWith: "„Ñê„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "jiao", replaceWith: "„Ñê„Ñß„Ñ†")
                varLineData.regReplace(pattern: "jing", replaceWith: "„Ñê„Ñß„Ñ•")
                varLineData.regReplace(pattern: "juan", replaceWith: "„Ñê„Ñ©„Ñ¢")
                varLineData.regReplace(pattern: "kang", replaceWith: "„Ñé„Ñ§")
                varLineData.regReplace(pattern: "keng", replaceWith: "„Ñé„Ñ•")
                varLineData.regReplace(pattern: "kong", replaceWith: "„Ñé„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "kuai", replaceWith: "„Ñé„Ñ®„Ñû")
                varLineData.regReplace(pattern: "kuan", replaceWith: "„Ñé„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "lang", replaceWith: "„Ñå„Ñ§")
                varLineData.regReplace(pattern: "leng", replaceWith: "„Ñå„Ñ•")
                varLineData.regReplace(pattern: "lian", replaceWith: "„Ñå„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "liao", replaceWith: "„Ñå„Ñß„Ñ†")
                varLineData.regReplace(pattern: "ling", replaceWith: "„Ñå„Ñß„Ñ•")
                varLineData.regReplace(pattern: "long", replaceWith: "„Ñå„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "luan", replaceWith: "„Ñå„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "lvan", replaceWith: "„Ñå„Ñ©„Ñ¢")
                varLineData.regReplace(pattern: "mang", replaceWith: "„Ñá„Ñ§")
                varLineData.regReplace(pattern: "meng", replaceWith: "„Ñá„Ñ•")
                varLineData.regReplace(pattern: "mian", replaceWith: "„Ñá„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "miao", replaceWith: "„Ñá„Ñß„Ñ†")
                varLineData.regReplace(pattern: "ming", replaceWith: "„Ñá„Ñß„Ñ•")
                varLineData.regReplace(pattern: "nang", replaceWith: "„Ñã„Ñ§")
                varLineData.regReplace(pattern: "neng", replaceWith: "„Ñã„Ñ•")
                varLineData.regReplace(pattern: "nian", replaceWith: "„Ñã„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "niao", replaceWith: "„Ñã„Ñß„Ñ†")
                varLineData.regReplace(pattern: "ning", replaceWith: "„Ñã„Ñß„Ñ•")
                varLineData.regReplace(pattern: "nong", replaceWith: "„Ñã„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "nuan", replaceWith: "„Ñã„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "pang", replaceWith: "„ÑÜ„Ñ§")
                varLineData.regReplace(pattern: "peng", replaceWith: "„ÑÜ„Ñ•")
                varLineData.regReplace(pattern: "pian", replaceWith: "„ÑÜ„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "piao", replaceWith: "„ÑÜ„Ñß„Ñ†")
                varLineData.regReplace(pattern: "ping", replaceWith: "„ÑÜ„Ñß„Ñ•")
                varLineData.regReplace(pattern: "qian", replaceWith: "„Ñë„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "qiao", replaceWith: "„Ñë„Ñß„Ñ†")
                varLineData.regReplace(pattern: "qing", replaceWith: "„Ñë„Ñß„Ñ•")
                varLineData.regReplace(pattern: "quan", replaceWith: "„Ñë„Ñ©„Ñ¢")
                varLineData.regReplace(pattern: "rang", replaceWith: "„Ññ„Ñ§")
                varLineData.regReplace(pattern: "reng", replaceWith: "„Ññ„Ñ•")
                varLineData.regReplace(pattern: "rong", replaceWith: "„Ññ„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "ruan", replaceWith: "„Ññ„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "sang", replaceWith: "„Ñô„Ñ§")
                varLineData.regReplace(pattern: "seng", replaceWith: "„Ñô„Ñ•")
                varLineData.regReplace(pattern: "shai", replaceWith: "„Ñï„Ñû")
                varLineData.regReplace(pattern: "shan", replaceWith: "„Ñï„Ñ¢")
                varLineData.regReplace(pattern: "shao", replaceWith: "„Ñï„Ñ†")
                varLineData.regReplace(pattern: "shei", replaceWith: "„Ñï„Ñü")
                varLineData.regReplace(pattern: "shen", replaceWith: "„Ñï„Ñ£")
                varLineData.regReplace(pattern: "shou", replaceWith: "„Ñï„Ñ°")
                varLineData.regReplace(pattern: "shua", replaceWith: "„Ñï„Ñ®„Ñö")
                varLineData.regReplace(pattern: "shui", replaceWith: "„Ñï„Ñ®„Ñü")
                varLineData.regReplace(pattern: "shun", replaceWith: "„Ñï„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "shuo", replaceWith: "„Ñï„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "song", replaceWith: "„Ñô„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "suan", replaceWith: "„Ñô„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "tang", replaceWith: "„Ñä„Ñ§")
                varLineData.regReplace(pattern: "teng", replaceWith: "„Ñä„Ñ•")
                varLineData.regReplace(pattern: "tian", replaceWith: "„Ñä„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "tiao", replaceWith: "„Ñä„Ñß„Ñ†")
                varLineData.regReplace(pattern: "ting", replaceWith: "„Ñä„Ñß„Ñ•")
                varLineData.regReplace(pattern: "tong", replaceWith: "„Ñä„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "tuan", replaceWith: "„Ñä„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "wang", replaceWith: "„Ñ®„Ñ§")
                varLineData.regReplace(pattern: "weng", replaceWith: "„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "xian", replaceWith: "„Ñí„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "xiao", replaceWith: "„Ñí„Ñß„Ñ†")
                varLineData.regReplace(pattern: "xing", replaceWith: "„Ñí„Ñß„Ñ•")
                varLineData.regReplace(pattern: "xuan", replaceWith: "„Ñí„Ñ©„Ñ¢")
                varLineData.regReplace(pattern: "yang", replaceWith: "„Ñß„Ñ§")
                varLineData.regReplace(pattern: "ying", replaceWith: "„Ñß„Ñ•")
                varLineData.regReplace(pattern: "yong", replaceWith: "„Ñ©„Ñ•")
                varLineData.regReplace(pattern: "yuan", replaceWith: "„Ñ©„Ñ¢")
                varLineData.regReplace(pattern: "zang", replaceWith: "„Ñó„Ñ§")
                varLineData.regReplace(pattern: "zeng", replaceWith: "„Ñó„Ñ•")
                varLineData.regReplace(pattern: "zhai", replaceWith: "„Ñì„Ñû")
                varLineData.regReplace(pattern: "zhan", replaceWith: "„Ñì„Ñ¢")
                varLineData.regReplace(pattern: "zhao", replaceWith: "„Ñì„Ñ†")
                varLineData.regReplace(pattern: "zhei", replaceWith: "„Ñì„Ñü")
                varLineData.regReplace(pattern: "zhen", replaceWith: "„Ñì„Ñ£")
                varLineData.regReplace(pattern: "zhou", replaceWith: "„Ñì„Ñ°")
                varLineData.regReplace(pattern: "zhua", replaceWith: "„Ñì„Ñ®„Ñö")
                varLineData.regReplace(pattern: "zhui", replaceWith: "„Ñì„Ñ®„Ñü")
                varLineData.regReplace(pattern: "zhun", replaceWith: "„Ñì„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "zhuo", replaceWith: "„Ñì„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "zong", replaceWith: "„Ñó„Ñ®„Ñ•")
                varLineData.regReplace(pattern: "zuan", replaceWith: "„Ñó„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "jun", replaceWith: "„Ñê„Ñ©„Ñ£")
                varLineData.regReplace(pattern: "ang", replaceWith: "„Ñ§")
                varLineData.regReplace(pattern: "bai", replaceWith: "„ÑÖ„Ñû")
                varLineData.regReplace(pattern: "ban", replaceWith: "„ÑÖ„Ñ¢")
                varLineData.regReplace(pattern: "bao", replaceWith: "„ÑÖ„Ñ†")
                varLineData.regReplace(pattern: "bei", replaceWith: "„ÑÖ„Ñü")
                varLineData.regReplace(pattern: "ben", replaceWith: "„ÑÖ„Ñ£")
                varLineData.regReplace(pattern: "bie", replaceWith: "„ÑÖ„Ñß„Ñù")
                varLineData.regReplace(pattern: "bin", replaceWith: "„ÑÖ„Ñß„Ñ£")
                varLineData.regReplace(pattern: "cai", replaceWith: "„Ñò„Ñû")
                varLineData.regReplace(pattern: "can", replaceWith: "„Ñò„Ñ¢")
                varLineData.regReplace(pattern: "cao", replaceWith: "„Ñò„Ñ†")
                varLineData.regReplace(pattern: "cen", replaceWith: "„Ñò„Ñ£")
                varLineData.regReplace(pattern: "cha", replaceWith: "„Ñî„Ñö")
                varLineData.regReplace(pattern: "che", replaceWith: "„Ñî„Ñú")
                varLineData.regReplace(pattern: "chi", replaceWith: "„Ñî")
                varLineData.regReplace(pattern: "chu", replaceWith: "„Ñî„Ñ®")
                varLineData.regReplace(pattern: "cou", replaceWith: "„Ñò„Ñ°")
                varLineData.regReplace(pattern: "cui", replaceWith: "„Ñò„Ñ®„Ñü")
                varLineData.regReplace(pattern: "cun", replaceWith: "„Ñò„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "cuo", replaceWith: "„Ñò„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "dai", replaceWith: "„Ñâ„Ñû")
                varLineData.regReplace(pattern: "dan", replaceWith: "„Ñâ„Ñ¢")
                varLineData.regReplace(pattern: "dao", replaceWith: "„Ñâ„Ñ†")
                varLineData.regReplace(pattern: "dei", replaceWith: "„Ñâ„Ñü")
                varLineData.regReplace(pattern: "den", replaceWith: "„Ñâ„Ñ£")
                varLineData.regReplace(pattern: "dia", replaceWith: "„Ñâ„Ñß„Ñö")
                varLineData.regReplace(pattern: "die", replaceWith: "„Ñâ„Ñß„Ñù")
                varLineData.regReplace(pattern: "diu", replaceWith: "„Ñâ„Ñß„Ñ°")
                varLineData.regReplace(pattern: "dou", replaceWith: "„Ñâ„Ñ°")
                varLineData.regReplace(pattern: "dui", replaceWith: "„Ñâ„Ñ®„Ñü")
                varLineData.regReplace(pattern: "dun", replaceWith: "„Ñâ„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "duo", replaceWith: "„Ñâ„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "eng", replaceWith: "„Ñ•")
                varLineData.regReplace(pattern: "fan", replaceWith: "„Ñà„Ñ¢")
                varLineData.regReplace(pattern: "fei", replaceWith: "„Ñà„Ñü")
                varLineData.regReplace(pattern: "fen", replaceWith: "„Ñà„Ñ£")
                varLineData.regReplace(pattern: "fou", replaceWith: "„Ñà„Ñ°")
                varLineData.regReplace(pattern: "gai", replaceWith: "„Ñç„Ñû")
                varLineData.regReplace(pattern: "gan", replaceWith: "„Ñç„Ñ¢")
                varLineData.regReplace(pattern: "gao", replaceWith: "„Ñç„Ñ†")
                varLineData.regReplace(pattern: "gei", replaceWith: "„Ñç„Ñü")
                varLineData.regReplace(pattern: "gin", replaceWith: "„Ñç„Ñß„Ñ£")
                varLineData.regReplace(pattern: "gen", replaceWith: "„Ñç„Ñ£")
                varLineData.regReplace(pattern: "gou", replaceWith: "„Ñç„Ñ°")
                varLineData.regReplace(pattern: "gua", replaceWith: "„Ñç„Ñ®„Ñö")
                varLineData.regReplace(pattern: "gue", replaceWith: "„Ñç„Ñ®„Ñú")
                varLineData.regReplace(pattern: "gui", replaceWith: "„Ñç„Ñ®„Ñü")
                varLineData.regReplace(pattern: "gun", replaceWith: "„Ñç„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "guo", replaceWith: "„Ñç„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "hai", replaceWith: "„Ñè„Ñû")
                varLineData.regReplace(pattern: "han", replaceWith: "„Ñè„Ñ¢")
                varLineData.regReplace(pattern: "hao", replaceWith: "„Ñè„Ñ†")
                varLineData.regReplace(pattern: "hei", replaceWith: "„Ñè„Ñü")
                varLineData.regReplace(pattern: "hen", replaceWith: "„Ñè„Ñ£")
                varLineData.regReplace(pattern: "hou", replaceWith: "„Ñè„Ñ°")
                varLineData.regReplace(pattern: "hua", replaceWith: "„Ñè„Ñ®„Ñö")
                varLineData.regReplace(pattern: "hui", replaceWith: "„Ñè„Ñ®„Ñü")
                varLineData.regReplace(pattern: "hun", replaceWith: "„Ñè„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "huo", replaceWith: "„Ñè„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "jia", replaceWith: "„Ñê„Ñß„Ñö")
                varLineData.regReplace(pattern: "jie", replaceWith: "„Ñê„Ñß„Ñù")
                varLineData.regReplace(pattern: "jin", replaceWith: "„Ñê„Ñß„Ñ£")
                varLineData.regReplace(pattern: "jiu", replaceWith: "„Ñê„Ñß„Ñ°")
                varLineData.regReplace(pattern: "jue", replaceWith: "„Ñê„Ñ©„Ñù")
                varLineData.regReplace(pattern: "kai", replaceWith: "„Ñé„Ñû")
                varLineData.regReplace(pattern: "kan", replaceWith: "„Ñé„Ñ¢")
                varLineData.regReplace(pattern: "kao", replaceWith: "„Ñé„Ñ†")
                varLineData.regReplace(pattern: "ken", replaceWith: "„Ñé„Ñ£")
                varLineData.regReplace(pattern: "kiu", replaceWith: "„Ñé„Ñß„Ñ°")
                varLineData.regReplace(pattern: "kou", replaceWith: "„Ñé„Ñ°")
                varLineData.regReplace(pattern: "kua", replaceWith: "„Ñé„Ñ®„Ñö")
                varLineData.regReplace(pattern: "kui", replaceWith: "„Ñé„Ñ®„Ñü")
                varLineData.regReplace(pattern: "kun", replaceWith: "„Ñé„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "kuo", replaceWith: "„Ñé„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "lai", replaceWith: "„Ñå„Ñû")
                varLineData.regReplace(pattern: "lan", replaceWith: "„Ñå„Ñ¢")
                varLineData.regReplace(pattern: "lao", replaceWith: "„Ñå„Ñ†")
                varLineData.regReplace(pattern: "lei", replaceWith: "„Ñå„Ñü")
                varLineData.regReplace(pattern: "lia", replaceWith: "„Ñå„Ñß„Ñö")
                varLineData.regReplace(pattern: "lie", replaceWith: "„Ñå„Ñß„Ñù")
                varLineData.regReplace(pattern: "lin", replaceWith: "„Ñå„Ñß„Ñ£")
                varLineData.regReplace(pattern: "liu", replaceWith: "„Ñå„Ñß„Ñ°")
                varLineData.regReplace(pattern: "lou", replaceWith: "„Ñå„Ñ°")
                varLineData.regReplace(pattern: "lun", replaceWith: "„Ñå„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "luo", replaceWith: "„Ñå„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "lve", replaceWith: "„Ñå„Ñ©„Ñù")
                varLineData.regReplace(pattern: "mai", replaceWith: "„Ñá„Ñû")
                varLineData.regReplace(pattern: "man", replaceWith: "„Ñá„Ñ¢")
                varLineData.regReplace(pattern: "mao", replaceWith: "„Ñá„Ñ†")
                varLineData.regReplace(pattern: "mei", replaceWith: "„Ñá„Ñü")
                varLineData.regReplace(pattern: "men", replaceWith: "„Ñá„Ñ£")
                varLineData.regReplace(pattern: "mie", replaceWith: "„Ñá„Ñß„Ñù")
                varLineData.regReplace(pattern: "min", replaceWith: "„Ñá„Ñß„Ñ£")
                varLineData.regReplace(pattern: "miu", replaceWith: "„Ñá„Ñß„Ñ°")
                varLineData.regReplace(pattern: "mou", replaceWith: "„Ñá„Ñ°")
                varLineData.regReplace(pattern: "nai", replaceWith: "„Ñã„Ñû")
                varLineData.regReplace(pattern: "nan", replaceWith: "„Ñã„Ñ¢")
                varLineData.regReplace(pattern: "nao", replaceWith: "„Ñã„Ñ†")
                varLineData.regReplace(pattern: "nei", replaceWith: "„Ñã„Ñü")
                varLineData.regReplace(pattern: "nen", replaceWith: "„Ñã„Ñ£")
                varLineData.regReplace(pattern: "nie", replaceWith: "„Ñã„Ñß„Ñù")
                varLineData.regReplace(pattern: "nin", replaceWith: "„Ñã„Ñß„Ñ£")
                varLineData.regReplace(pattern: "niu", replaceWith: "„Ñã„Ñß„Ñ°")
                varLineData.regReplace(pattern: "nou", replaceWith: "„Ñã„Ñ°")
                varLineData.regReplace(pattern: "nui", replaceWith: "„Ñã„Ñ®„Ñü")
                varLineData.regReplace(pattern: "nun", replaceWith: "„Ñã„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "nuo", replaceWith: "„Ñã„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "nve", replaceWith: "„Ñã„Ñ©„Ñù")
                varLineData.regReplace(pattern: "pai", replaceWith: "„ÑÜ„Ñû")
                varLineData.regReplace(pattern: "pan", replaceWith: "„ÑÜ„Ñ¢")
                varLineData.regReplace(pattern: "pao", replaceWith: "„ÑÜ„Ñ†")
                varLineData.regReplace(pattern: "pei", replaceWith: "„ÑÜ„Ñü")
                varLineData.regReplace(pattern: "pen", replaceWith: "„ÑÜ„Ñ£")
                varLineData.regReplace(pattern: "pia", replaceWith: "„ÑÜ„Ñß„Ñö")
                varLineData.regReplace(pattern: "pie", replaceWith: "„ÑÜ„Ñß„Ñù")
                varLineData.regReplace(pattern: "pin", replaceWith: "„ÑÜ„Ñß„Ñ£")
                varLineData.regReplace(pattern: "pou", replaceWith: "„ÑÜ„Ñ°")
                varLineData.regReplace(pattern: "qia", replaceWith: "„Ñë„Ñß„Ñö")
                varLineData.regReplace(pattern: "qie", replaceWith: "„Ñë„Ñß„Ñù")
                varLineData.regReplace(pattern: "qin", replaceWith: "„Ñë„Ñß„Ñ£")
                varLineData.regReplace(pattern: "qiu", replaceWith: "„Ñë„Ñß„Ñ°")
                varLineData.regReplace(pattern: "que", replaceWith: "„Ñë„Ñ©„Ñù")
                varLineData.regReplace(pattern: "qun", replaceWith: "„Ñë„Ñ©„Ñ£")
                varLineData.regReplace(pattern: "ran", replaceWith: "„Ññ„Ñ¢")
                varLineData.regReplace(pattern: "rao", replaceWith: "„Ññ„Ñ†")
                varLineData.regReplace(pattern: "ren", replaceWith: "„Ññ„Ñ£")
                varLineData.regReplace(pattern: "rou", replaceWith: "„Ññ„Ñ°")
                varLineData.regReplace(pattern: "rui", replaceWith: "„Ññ„Ñ®„Ñü")
                varLineData.regReplace(pattern: "run", replaceWith: "„Ññ„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "ruo", replaceWith: "„Ññ„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "sai", replaceWith: "„Ñô„Ñû")
                varLineData.regReplace(pattern: "san", replaceWith: "„Ñô„Ñ¢")
                varLineData.regReplace(pattern: "sao", replaceWith: "„Ñô„Ñ†")
                varLineData.regReplace(pattern: "sei", replaceWith: "„Ñô„Ñü")
                varLineData.regReplace(pattern: "sen", replaceWith: "„Ñô„Ñ£")
                varLineData.regReplace(pattern: "sha", replaceWith: "„Ñï„Ñö")
                varLineData.regReplace(pattern: "she", replaceWith: "„Ñï„Ñú")
                varLineData.regReplace(pattern: "shi", replaceWith: "„Ñï")
                varLineData.regReplace(pattern: "shu", replaceWith: "„Ñï„Ñ®")
                varLineData.regReplace(pattern: "sou", replaceWith: "„Ñô„Ñ°")
                varLineData.regReplace(pattern: "sui", replaceWith: "„Ñô„Ñ®„Ñü")
                varLineData.regReplace(pattern: "sun", replaceWith: "„Ñô„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "suo", replaceWith: "„Ñô„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "tai", replaceWith: "„Ñä„Ñû")
                varLineData.regReplace(pattern: "tan", replaceWith: "„Ñä„Ñ¢")
                varLineData.regReplace(pattern: "tao", replaceWith: "„Ñä„Ñ†")
                varLineData.regReplace(pattern: "tie", replaceWith: "„Ñä„Ñß„Ñù")
                varLineData.regReplace(pattern: "tou", replaceWith: "„Ñä„Ñ°")
                varLineData.regReplace(pattern: "tui", replaceWith: "„Ñä„Ñ®„Ñü")
                varLineData.regReplace(pattern: "tun", replaceWith: "„Ñä„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "tuo", replaceWith: "„Ñä„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "wai", replaceWith: "„Ñ®„Ñû")
                varLineData.regReplace(pattern: "wan", replaceWith: "„Ñ®„Ñ¢")
                varLineData.regReplace(pattern: "wei", replaceWith: "„Ñ®„Ñü")
                varLineData.regReplace(pattern: "wen", replaceWith: "„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "xia", replaceWith: "„Ñí„Ñß„Ñö")
                varLineData.regReplace(pattern: "xie", replaceWith: "„Ñí„Ñß„Ñù")
                varLineData.regReplace(pattern: "xin", replaceWith: "„Ñí„Ñß„Ñ£")
                varLineData.regReplace(pattern: "xiu", replaceWith: "„Ñí„Ñß„Ñ°")
                varLineData.regReplace(pattern: "xue", replaceWith: "„Ñí„Ñ©„Ñù")
                varLineData.regReplace(pattern: "xun", replaceWith: "„Ñí„Ñ©„Ñ£")
                varLineData.regReplace(pattern: "yai", replaceWith: "„Ñß„Ñû")
                varLineData.regReplace(pattern: "yan", replaceWith: "„Ñß„Ñ¢")
                varLineData.regReplace(pattern: "yao", replaceWith: "„Ñß„Ñ†")
                varLineData.regReplace(pattern: "yin", replaceWith: "„Ñß„Ñ£")
                varLineData.regReplace(pattern: "you", replaceWith: "„Ñß„Ñ°")
                varLineData.regReplace(pattern: "yue", replaceWith: "„Ñ©„Ñù")
                varLineData.regReplace(pattern: "yun", replaceWith: "„Ñ©„Ñ£")
                varLineData.regReplace(pattern: "zai", replaceWith: "„Ñó„Ñû")
                varLineData.regReplace(pattern: "zan", replaceWith: "„Ñó„Ñ¢")
                varLineData.regReplace(pattern: "zao", replaceWith: "„Ñó„Ñ†")
                varLineData.regReplace(pattern: "zei", replaceWith: "„Ñó„Ñü")
                varLineData.regReplace(pattern: "zen", replaceWith: "„Ñó„Ñ£")
                varLineData.regReplace(pattern: "zha", replaceWith: "„Ñì„Ñö")
                varLineData.regReplace(pattern: "zhe", replaceWith: "„Ñì„Ñú")
                varLineData.regReplace(pattern: "zhi", replaceWith: "„Ñì")
                varLineData.regReplace(pattern: "zhu", replaceWith: "„Ñì„Ñ®")
                varLineData.regReplace(pattern: "zou", replaceWith: "„Ñó„Ñ°")
                varLineData.regReplace(pattern: "zui", replaceWith: "„Ñó„Ñ®„Ñü")
                varLineData.regReplace(pattern: "zun", replaceWith: "„Ñó„Ñ®„Ñ£")
                varLineData.regReplace(pattern: "zuo", replaceWith: "„Ñó„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "ai", replaceWith: "„Ñû")
                varLineData.regReplace(pattern: "an", replaceWith: "„Ñ¢")
                varLineData.regReplace(pattern: "ao", replaceWith: "„Ñ†")
                varLineData.regReplace(pattern: "ba", replaceWith: "„ÑÖ„Ñö")
                varLineData.regReplace(pattern: "bi", replaceWith: "„ÑÖ„Ñß")
                varLineData.regReplace(pattern: "bo", replaceWith: "„ÑÖ„Ñõ")
                varLineData.regReplace(pattern: "bu", replaceWith: "„ÑÖ„Ñ®")
                varLineData.regReplace(pattern: "ca", replaceWith: "„Ñò„Ñö")
                varLineData.regReplace(pattern: "ce", replaceWith: "„Ñò„Ñú")
                varLineData.regReplace(pattern: "ci", replaceWith: "„Ñò")
                varLineData.regReplace(pattern: "cu", replaceWith: "„Ñò„Ñ®")
                varLineData.regReplace(pattern: "da", replaceWith: "„Ñâ„Ñö")
                varLineData.regReplace(pattern: "de", replaceWith: "„Ñâ„Ñú")
                varLineData.regReplace(pattern: "di", replaceWith: "„Ñâ„Ñß")
                varLineData.regReplace(pattern: "du", replaceWith: "„Ñâ„Ñ®")
                varLineData.regReplace(pattern: "eh", replaceWith: "„Ñù")
                varLineData.regReplace(pattern: "ei", replaceWith: "„Ñü")
                varLineData.regReplace(pattern: "en", replaceWith: "„Ñ£")
                varLineData.regReplace(pattern: "er", replaceWith: "„Ñ¶")
                varLineData.regReplace(pattern: "fa", replaceWith: "„Ñà„Ñö")
                varLineData.regReplace(pattern: "fo", replaceWith: "„Ñà„Ñõ")
                varLineData.regReplace(pattern: "fu", replaceWith: "„Ñà„Ñ®")
                varLineData.regReplace(pattern: "ga", replaceWith: "„Ñç„Ñö")
                varLineData.regReplace(pattern: "ge", replaceWith: "„Ñç„Ñú")
                varLineData.regReplace(pattern: "gi", replaceWith: "„Ñç„Ñß")
                varLineData.regReplace(pattern: "gu", replaceWith: "„Ñç„Ñ®")
                varLineData.regReplace(pattern: "ha", replaceWith: "„Ñè„Ñö")
                varLineData.regReplace(pattern: "he", replaceWith: "„Ñè„Ñú")
                varLineData.regReplace(pattern: "hu", replaceWith: "„Ñè„Ñ®")
                varLineData.regReplace(pattern: "ji", replaceWith: "„Ñê„Ñß")
                varLineData.regReplace(pattern: "ju", replaceWith: "„Ñê„Ñ©")
                varLineData.regReplace(pattern: "ka", replaceWith: "„Ñé„Ñö")
                varLineData.regReplace(pattern: "ke", replaceWith: "„Ñé„Ñú")
                varLineData.regReplace(pattern: "ku", replaceWith: "„Ñé„Ñ®")
                varLineData.regReplace(pattern: "la", replaceWith: "„Ñå„Ñö")
                varLineData.regReplace(pattern: "le", replaceWith: "„Ñå„Ñú")
                varLineData.regReplace(pattern: "li", replaceWith: "„Ñå„Ñß")
                varLineData.regReplace(pattern: "lo", replaceWith: "„Ñå„Ñõ")
                varLineData.regReplace(pattern: "lu", replaceWith: "„Ñå„Ñ®")
                varLineData.regReplace(pattern: "lv", replaceWith: "„Ñå„Ñ©")
                varLineData.regReplace(pattern: "ma", replaceWith: "„Ñá„Ñö")
                varLineData.regReplace(pattern: "me", replaceWith: "„Ñá„Ñú")
                varLineData.regReplace(pattern: "mi", replaceWith: "„Ñá„Ñß")
                varLineData.regReplace(pattern: "mo", replaceWith: "„Ñá„Ñõ")
                varLineData.regReplace(pattern: "mu", replaceWith: "„Ñá„Ñ®")
                varLineData.regReplace(pattern: "na", replaceWith: "„Ñã„Ñö")
                varLineData.regReplace(pattern: "ne", replaceWith: "„Ñã„Ñú")
                varLineData.regReplace(pattern: "ni", replaceWith: "„Ñã„Ñß")
                varLineData.regReplace(pattern: "nu", replaceWith: "„Ñã„Ñ®")
                varLineData.regReplace(pattern: "nv", replaceWith: "„Ñã„Ñ©")
                varLineData.regReplace(pattern: "ou", replaceWith: "„Ñ°")
                varLineData.regReplace(pattern: "pa", replaceWith: "„ÑÜ„Ñö")
                varLineData.regReplace(pattern: "pi", replaceWith: "„ÑÜ„Ñß")
                varLineData.regReplace(pattern: "po", replaceWith: "„ÑÜ„Ñõ")
                varLineData.regReplace(pattern: "pu", replaceWith: "„ÑÜ„Ñ®")
                varLineData.regReplace(pattern: "qi", replaceWith: "„Ñë„Ñß")
                varLineData.regReplace(pattern: "qu", replaceWith: "„Ñë„Ñ©")
                varLineData.regReplace(pattern: "re", replaceWith: "„Ññ„Ñú")
                varLineData.regReplace(pattern: "ri", replaceWith: "„Ññ")
                varLineData.regReplace(pattern: "ru", replaceWith: "„Ññ„Ñ®")
                varLineData.regReplace(pattern: "sa", replaceWith: "„Ñô„Ñö")
                varLineData.regReplace(pattern: "se", replaceWith: "„Ñô„Ñú")
                varLineData.regReplace(pattern: "si", replaceWith: "„Ñô")
                varLineData.regReplace(pattern: "su", replaceWith: "„Ñô„Ñ®")
                varLineData.regReplace(pattern: "ta", replaceWith: "„Ñä„Ñö")
                varLineData.regReplace(pattern: "te", replaceWith: "„Ñä„Ñú")
                varLineData.regReplace(pattern: "ti", replaceWith: "„Ñä„Ñß")
                varLineData.regReplace(pattern: "tu", replaceWith: "„Ñä„Ñ®")
                varLineData.regReplace(pattern: "wa", replaceWith: "„Ñ®„Ñö")
                varLineData.regReplace(pattern: "wo", replaceWith: "„Ñ®„Ñõ")
                varLineData.regReplace(pattern: "wu", replaceWith: "„Ñ®")
                varLineData.regReplace(pattern: "xi", replaceWith: "„Ñí„Ñß")
                varLineData.regReplace(pattern: "xu", replaceWith: "„Ñí„Ñ©")
                varLineData.regReplace(pattern: "ya", replaceWith: "„Ñß„Ñö")
                varLineData.regReplace(pattern: "ye", replaceWith: "„Ñß„Ñù")
                varLineData.regReplace(pattern: "yi", replaceWith: "„Ñß")
                varLineData.regReplace(pattern: "yo", replaceWith: "„Ñß„Ñõ")
                varLineData.regReplace(pattern: "yu", replaceWith: "„Ñ©")
                varLineData.regReplace(pattern: "za", replaceWith: "„Ñó„Ñö")
                varLineData.regReplace(pattern: "ze", replaceWith: "„Ñó„Ñú")
                varLineData.regReplace(pattern: "zi", replaceWith: "„Ñó")
                varLineData.regReplace(pattern: "zu", replaceWith: "„Ñó„Ñ®")
                varLineData.regReplace(pattern: "a", replaceWith: "„Ñö")
                varLineData.regReplace(pattern: "e", replaceWith: "„Ñú")
                varLineData.regReplace(pattern: "o", replaceWith: "„Ñõ")
                varLineData.regReplace(pattern: "q", replaceWith: "„Ñë")
                varLineData.regReplace(pattern: "2", replaceWith: "Àä")
                varLineData.regReplace(pattern: "3", replaceWith: "Àá")
                varLineData.regReplace(pattern: "4", replaceWith: "Àã")
                varLineData.regReplace(pattern: "5", replaceWith: "Àô")
                varLineData.regReplace(pattern: "1", replaceWith: "")
                strProcessed += varLineData
                strProcessed += "\n"
            }
        }
        
        // Step 3: Add Formatted Pragma
        let hdrFormatted = "# ùôµùôæùöÅùôºùô∞ùöÉ ùöòùöõùöê.ùöäùöùùöéùöïùöíùöéùöõùô∏ùöóùöñùöû.ùöüùöåùöëùöéùö†ùöíùöóùöê.ùöûùöúùöéùöõùôªùöäùöóùöêùöûùöäùöêùöéùôºùöòùöçùöéùöïùô≥ùöäùöùùöä.ùöèùöòùöõùöñùöäùöùùöùùöéùöç\n" // Sorted Header
        strProcessed = hdrFormatted + strProcessed // Add Sorted Header
        
        // Step 4: Deduplication.
        arrData = strProcessed.components(separatedBy: "\n")
        strProcessed = "" // Reset its value
        // ‰∏ãÈù¢ÂÖ©Ë°åÁöÑ reversed ÊòØÈ¶ñÂ∞æÈ°õÂÄíÔºåÂÖçÂæóÁ†¥Â£ûÊúÄÊñ∞ÁöÑ override Ë≥áË®ä„ÄÇ
        let arrDataDeduplicated = Array(NSOrderedSet(array: arrData.reversed()).array as! [String])
        for lineData in arrDataDeduplicated.reversed() {
            strProcessed += lineData
            strProcessed += "\n"
        }
        
        // Step 5: Remove duplicated newlines at the end of the file.
        strProcessed.regReplace(pattern: "\\n+", replaceWith: "\n")
        
        // Step 6: Commit Formatted Contents.
        self = strProcessed
    }
}
