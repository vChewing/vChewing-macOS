// Copyright (c) 2021 and onwards The vChewing Project (MIT-NTL License).
/*
Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

1. The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

2. No trademark license is granted to use the trade names, trademarks, service
marks, or product names of Contributor, except as required to fulfill notice
requirements above.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

import Foundation

extension String {
  mutating func regReplace(pattern: String, replaceWith: String = "") {
    // Ref: https://stackoverflow.com/a/40993403/4162914 && https://stackoverflow.com/a/71291137/4162914
    do {
      let regex = try NSRegularExpression(
        pattern: pattern, options: [.caseInsensitive, .anchorsMatchLines]
      )
      let range = NSRange(startIndex..., in: self)
      self = regex.stringByReplacingMatches(
        in: self, options: [], range: range, withTemplate: replaceWith
      )
    } catch { return }
  }

  mutating func selfReplace(_ strOf: String, _ strWith: String = "") {
    self = replacingOccurrences(of: strOf, with: strWith)
  }

  mutating func formatConsolidate(cnvHYPYtoBPMF: Bool) {
    // Step 1: Consolidating formats per line.
    var strProcessed = self
    // È†êËôïÁêÜÊ†ºÂºè
    strProcessed = strProcessed.replacingOccurrences(of: " #MACOS", with: "")  // ÂéªÊéâ macOS Ê®ôË®ò
    // CJKWhiteSpace (\x{3000}) to ASCII Space
    // NonBreakWhiteSpace (\x{A0}) to ASCII Space
    // Tab to ASCII Space
    // Áµ±Êï¥ÈÄ£Á∫åÁ©∫Ê†ºÁÇ∫‰∏ÄÂÄã ASCII Á©∫Ê†º
    strProcessed.regReplace(pattern: #"(¬†+|„ÄÄ+| +|\t+)+"#, replaceWith: " ")
    // ÂéªÈô§Ë°åÂ∞æË°åÈ¶ñÁ©∫Ê†º
    strProcessed.regReplace(pattern: #"(^ | $)"#, replaceWith: "")
    strProcessed.regReplace(pattern: #"(\n | \n)"#, replaceWith: "\n")
    // CR & FF to LF, ‰∏îÂéªÈô§ÈáçË§áË°å
    strProcessed.regReplace(pattern: #"(\f+|\r+|\n+)+"#, replaceWith: "\n")
    if strProcessed.prefix(1) == " " {  // ÂéªÈô§Ê™îÊ°àÈñãÈ†≠Á©∫Ê†º
      strProcessed.removeFirst()
    }
    if strProcessed.suffix(1) == " " {  // ÂéªÈô§Ê™îÊ°àÁµêÂ∞æÁ©∫Ê†º
      strProcessed.removeLast()
    }

    if cnvHYPYtoBPMF {
      // Step 2: Convert HanyuPinyin to Bopomofo.
      // Êº¢Ë™ûÊãºÈü≥ËΩâÊ≥®Èü≥ÔºåÂæóÂÖàÂæûÊúÄÈï∑ÁöÑÂèØËÉΩÁöÑÊãºÈü≥ÁµÑÂêàÈñãÂßãËΩâËµ∑Ôºå
      // ÈÄôÊ®£Á≠âËΩâÊèõÂà∞Êõ¥Áü≠ÁöÑÂèØËÉΩÁöÑÊº¢Ë™ûÊãºÈü≥ÁµÑÂêàÊôÇÂ∞±‰∏çÊúÉÂá∫ÈåØ„ÄÇ
      // ‰æùÊ≠§È°ûÊé®ÔºåËÅ≤Ë™øÊîæÂú®ÊúÄÂæå‰æÜËΩâÊèõ„ÄÇ
      strProcessed.selfReplace("chuang", "„Ñî„Ñ®„Ñ§")
      strProcessed.selfReplace("shuang", "„Ñï„Ñ®„Ñ§")
      strProcessed.selfReplace("zhuang", "„Ñì„Ñ®„Ñ§")
      strProcessed.selfReplace("chang", "„Ñî„Ñ§")
      strProcessed.selfReplace("cheng", "„Ñî„Ñ•")
      strProcessed.selfReplace("chong", "„Ñî„Ñ®„Ñ•")
      strProcessed.selfReplace("chuai", "„Ñî„Ñ®„Ñû")
      strProcessed.selfReplace("chuan", "„Ñî„Ñ®„Ñ¢")
      strProcessed.selfReplace("guang", "„Ñç„Ñ®„Ñ§")
      strProcessed.selfReplace("huang", "„Ñè„Ñ®„Ñ§")
      strProcessed.selfReplace("jiang", "„Ñê„Ñß„Ñ§")
      strProcessed.selfReplace("jiong", "„Ñê„Ñ©„Ñ•")
      strProcessed.selfReplace("kuang", "„Ñé„Ñ®„Ñ§")
      strProcessed.selfReplace("liang", "„Ñå„Ñß„Ñ§")
      strProcessed.selfReplace("niang", "„Ñã„Ñß„Ñ§")
      strProcessed.selfReplace("qiang", "„Ñë„Ñß„Ñ§")
      strProcessed.selfReplace("qiong", "„Ñë„Ñ©„Ñ•")
      strProcessed.selfReplace("shang", "„Ñï„Ñ§")
      strProcessed.selfReplace("sheng", "„Ñï„Ñ•")
      strProcessed.selfReplace("shuai", "„Ñï„Ñ®„Ñû")
      strProcessed.selfReplace("shuan", "„Ñï„Ñ®„Ñ¢")
      strProcessed.selfReplace("xiang", "„Ñí„Ñß„Ñ§")
      strProcessed.selfReplace("xiong", "„Ñí„Ñ©„Ñ•")
      strProcessed.selfReplace("zhang", "„Ñì„Ñ§")
      strProcessed.selfReplace("zheng", "„Ñì„Ñ•")
      strProcessed.selfReplace("zhong", "„Ñì„Ñ®„Ñ•")
      strProcessed.selfReplace("zhuai", "„Ñì„Ñ®„Ñû")
      strProcessed.selfReplace("zhuan", "„Ñì„Ñ®„Ñ¢")
      strProcessed.selfReplace("bang", "„ÑÖ„Ñ§")
      strProcessed.selfReplace("beng", "„ÑÖ„Ñ•")
      strProcessed.selfReplace("bian", "„ÑÖ„Ñß„Ñ¢")
      strProcessed.selfReplace("biao", "„ÑÖ„Ñß„Ñ†")
      strProcessed.selfReplace("bing", "„ÑÖ„Ñß„Ñ•")
      strProcessed.selfReplace("cang", "„Ñò„Ñ§")
      strProcessed.selfReplace("ceng", "„Ñò„Ñ•")
      strProcessed.selfReplace("chai", "„Ñî„Ñû")
      strProcessed.selfReplace("chan", "„Ñî„Ñ¢")
      strProcessed.selfReplace("chao", "„Ñî„Ñ†")
      strProcessed.selfReplace("chen", "„Ñî„Ñ£")
      strProcessed.selfReplace("chou", "„Ñî„Ñ°")
      strProcessed.selfReplace("chua", "„Ñî„Ñ®„Ñö")
      strProcessed.selfReplace("chui", "„Ñî„Ñ®„Ñü")
      strProcessed.selfReplace("chun", "„Ñî„Ñ®„Ñ£")
      strProcessed.selfReplace("chuo", "„Ñî„Ñ®„Ñõ")
      strProcessed.selfReplace("cong", "„Ñò„Ñ®„Ñ•")
      strProcessed.selfReplace("cuan", "„Ñò„Ñ®„Ñ¢")
      strProcessed.selfReplace("dang", "„Ñâ„Ñ§")
      strProcessed.selfReplace("deng", "„Ñâ„Ñ•")
      strProcessed.selfReplace("dian", "„Ñâ„Ñß„Ñ¢")
      strProcessed.selfReplace("diao", "„Ñâ„Ñß„Ñ†")
      strProcessed.selfReplace("ding", "„Ñâ„Ñß„Ñ•")
      strProcessed.selfReplace("dong", "„Ñâ„Ñ®„Ñ•")
      strProcessed.selfReplace("duan", "„Ñâ„Ñ®„Ñ¢")
      strProcessed.selfReplace("fang", "„Ñà„Ñ§")
      strProcessed.selfReplace("feng", "„Ñà„Ñ•")
      strProcessed.selfReplace("fiao", "„Ñà„Ñß„Ñ†")
      strProcessed.selfReplace("fong", "„Ñà„Ñ®„Ñ•")
      strProcessed.selfReplace("gang", "„Ñç„Ñ§")
      strProcessed.selfReplace("geng", "„Ñç„Ñ•")
      strProcessed.selfReplace("giao", "„Ñç„Ñß„Ñ†")
      strProcessed.selfReplace("gong", "„Ñç„Ñ®„Ñ•")
      strProcessed.selfReplace("guai", "„Ñç„Ñ®„Ñû")
      strProcessed.selfReplace("guan", "„Ñç„Ñ®„Ñ¢")
      strProcessed.selfReplace("hang", "„Ñè„Ñ§")
      strProcessed.selfReplace("heng", "„Ñè„Ñ•")
      strProcessed.selfReplace("hong", "„Ñè„Ñ®„Ñ•")
      strProcessed.selfReplace("huai", "„Ñè„Ñ®„Ñû")
      strProcessed.selfReplace("huan", "„Ñè„Ñ®„Ñ¢")
      strProcessed.selfReplace("jian", "„Ñê„Ñß„Ñ¢")
      strProcessed.selfReplace("jiao", "„Ñê„Ñß„Ñ†")
      strProcessed.selfReplace("jing", "„Ñê„Ñß„Ñ•")
      strProcessed.selfReplace("juan", "„Ñê„Ñ©„Ñ¢")
      strProcessed.selfReplace("kang", "„Ñé„Ñ§")
      strProcessed.selfReplace("keng", "„Ñé„Ñ•")
      strProcessed.selfReplace("kong", "„Ñé„Ñ®„Ñ•")
      strProcessed.selfReplace("kuai", "„Ñé„Ñ®„Ñû")
      strProcessed.selfReplace("kuan", "„Ñé„Ñ®„Ñ¢")
      strProcessed.selfReplace("lang", "„Ñå„Ñ§")
      strProcessed.selfReplace("leng", "„Ñå„Ñ•")
      strProcessed.selfReplace("lian", "„Ñå„Ñß„Ñ¢")
      strProcessed.selfReplace("liao", "„Ñå„Ñß„Ñ†")
      strProcessed.selfReplace("ling", "„Ñå„Ñß„Ñ•")
      strProcessed.selfReplace("long", "„Ñå„Ñ®„Ñ•")
      strProcessed.selfReplace("luan", "„Ñå„Ñ®„Ñ¢")
      strProcessed.selfReplace("lvan", "„Ñå„Ñ©„Ñ¢")
      strProcessed.selfReplace("mang", "„Ñá„Ñ§")
      strProcessed.selfReplace("meng", "„Ñá„Ñ•")
      strProcessed.selfReplace("mian", "„Ñá„Ñß„Ñ¢")
      strProcessed.selfReplace("miao", "„Ñá„Ñß„Ñ†")
      strProcessed.selfReplace("ming", "„Ñá„Ñß„Ñ•")
      strProcessed.selfReplace("nang", "„Ñã„Ñ§")
      strProcessed.selfReplace("neng", "„Ñã„Ñ•")
      strProcessed.selfReplace("nian", "„Ñã„Ñß„Ñ¢")
      strProcessed.selfReplace("niao", "„Ñã„Ñß„Ñ†")
      strProcessed.selfReplace("ning", "„Ñã„Ñß„Ñ•")
      strProcessed.selfReplace("nong", "„Ñã„Ñ®„Ñ•")
      strProcessed.selfReplace("nuan", "„Ñã„Ñ®„Ñ¢")
      strProcessed.selfReplace("pang", "„ÑÜ„Ñ§")
      strProcessed.selfReplace("peng", "„ÑÜ„Ñ•")
      strProcessed.selfReplace("pian", "„ÑÜ„Ñß„Ñ¢")
      strProcessed.selfReplace("piao", "„ÑÜ„Ñß„Ñ†")
      strProcessed.selfReplace("ping", "„ÑÜ„Ñß„Ñ•")
      strProcessed.selfReplace("qian", "„Ñë„Ñß„Ñ¢")
      strProcessed.selfReplace("qiao", "„Ñë„Ñß„Ñ†")
      strProcessed.selfReplace("qing", "„Ñë„Ñß„Ñ•")
      strProcessed.selfReplace("quan", "„Ñë„Ñ©„Ñ¢")
      strProcessed.selfReplace("rang", "„Ññ„Ñ§")
      strProcessed.selfReplace("reng", "„Ññ„Ñ•")
      strProcessed.selfReplace("rong", "„Ññ„Ñ®„Ñ•")
      strProcessed.selfReplace("ruan", "„Ññ„Ñ®„Ñ¢")
      strProcessed.selfReplace("sang", "„Ñô„Ñ§")
      strProcessed.selfReplace("seng", "„Ñô„Ñ•")
      strProcessed.selfReplace("shai", "„Ñï„Ñû")
      strProcessed.selfReplace("shan", "„Ñï„Ñ¢")
      strProcessed.selfReplace("shao", "„Ñï„Ñ†")
      strProcessed.selfReplace("shei", "„Ñï„Ñü")
      strProcessed.selfReplace("shen", "„Ñï„Ñ£")
      strProcessed.selfReplace("shou", "„Ñï„Ñ°")
      strProcessed.selfReplace("shua", "„Ñï„Ñ®„Ñö")
      strProcessed.selfReplace("shui", "„Ñï„Ñ®„Ñü")
      strProcessed.selfReplace("shun", "„Ñï„Ñ®„Ñ£")
      strProcessed.selfReplace("shuo", "„Ñï„Ñ®„Ñõ")
      strProcessed.selfReplace("song", "„Ñô„Ñ®„Ñ•")
      strProcessed.selfReplace("suan", "„Ñô„Ñ®„Ñ¢")
      strProcessed.selfReplace("tang", "„Ñä„Ñ§")
      strProcessed.selfReplace("teng", "„Ñä„Ñ•")
      strProcessed.selfReplace("tian", "„Ñä„Ñß„Ñ¢")
      strProcessed.selfReplace("tiao", "„Ñä„Ñß„Ñ†")
      strProcessed.selfReplace("ting", "„Ñä„Ñß„Ñ•")
      strProcessed.selfReplace("tong", "„Ñä„Ñ®„Ñ•")
      strProcessed.selfReplace("tuan", "„Ñä„Ñ®„Ñ¢")
      strProcessed.selfReplace("wang", "„Ñ®„Ñ§")
      strProcessed.selfReplace("weng", "„Ñ®„Ñ•")
      strProcessed.selfReplace("xian", "„Ñí„Ñß„Ñ¢")
      strProcessed.selfReplace("xiao", "„Ñí„Ñß„Ñ†")
      strProcessed.selfReplace("xing", "„Ñí„Ñß„Ñ•")
      strProcessed.selfReplace("xuan", "„Ñí„Ñ©„Ñ¢")
      strProcessed.selfReplace("yang", "„Ñß„Ñ§")
      strProcessed.selfReplace("ying", "„Ñß„Ñ•")
      strProcessed.selfReplace("yong", "„Ñ©„Ñ•")
      strProcessed.selfReplace("yuan", "„Ñ©„Ñ¢")
      strProcessed.selfReplace("zang", "„Ñó„Ñ§")
      strProcessed.selfReplace("zeng", "„Ñó„Ñ•")
      strProcessed.selfReplace("zhai", "„Ñì„Ñû")
      strProcessed.selfReplace("zhan", "„Ñì„Ñ¢")
      strProcessed.selfReplace("zhao", "„Ñì„Ñ†")
      strProcessed.selfReplace("zhei", "„Ñì„Ñü")
      strProcessed.selfReplace("zhen", "„Ñì„Ñ£")
      strProcessed.selfReplace("zhou", "„Ñì„Ñ°")
      strProcessed.selfReplace("zhua", "„Ñì„Ñ®„Ñö")
      strProcessed.selfReplace("zhui", "„Ñì„Ñ®„Ñü")
      strProcessed.selfReplace("zhun", "„Ñì„Ñ®„Ñ£")
      strProcessed.selfReplace("zhuo", "„Ñì„Ñ®„Ñõ")
      strProcessed.selfReplace("zong", "„Ñó„Ñ®„Ñ•")
      strProcessed.selfReplace("zuan", "„Ñó„Ñ®„Ñ¢")
      strProcessed.selfReplace("jun", "„Ñê„Ñ©„Ñ£")
      strProcessed.selfReplace("ang", "„Ñ§")
      strProcessed.selfReplace("bai", "„ÑÖ„Ñû")
      strProcessed.selfReplace("ban", "„ÑÖ„Ñ¢")
      strProcessed.selfReplace("bao", "„ÑÖ„Ñ†")
      strProcessed.selfReplace("bei", "„ÑÖ„Ñü")
      strProcessed.selfReplace("ben", "„ÑÖ„Ñ£")
      strProcessed.selfReplace("bie", "„ÑÖ„Ñß„Ñù")
      strProcessed.selfReplace("bin", "„ÑÖ„Ñß„Ñ£")
      strProcessed.selfReplace("cai", "„Ñò„Ñû")
      strProcessed.selfReplace("can", "„Ñò„Ñ¢")
      strProcessed.selfReplace("cao", "„Ñò„Ñ†")
      strProcessed.selfReplace("cei", "„Ñò„Ñü")
      strProcessed.selfReplace("cen", "„Ñò„Ñ£")
      strProcessed.selfReplace("cha", "„Ñî„Ñö")
      strProcessed.selfReplace("che", "„Ñî„Ñú")
      strProcessed.selfReplace("chi", "„Ñî")
      strProcessed.selfReplace("chu", "„Ñî„Ñ®")
      strProcessed.selfReplace("cou", "„Ñò„Ñ°")
      strProcessed.selfReplace("cui", "„Ñò„Ñ®„Ñü")
      strProcessed.selfReplace("cun", "„Ñò„Ñ®„Ñ£")
      strProcessed.selfReplace("cuo", "„Ñò„Ñ®„Ñõ")
      strProcessed.selfReplace("dai", "„Ñâ„Ñû")
      strProcessed.selfReplace("dan", "„Ñâ„Ñ¢")
      strProcessed.selfReplace("dao", "„Ñâ„Ñ†")
      strProcessed.selfReplace("dei", "„Ñâ„Ñü")
      strProcessed.selfReplace("den", "„Ñâ„Ñ£")
      strProcessed.selfReplace("dia", "„Ñâ„Ñß„Ñö")
      strProcessed.selfReplace("die", "„Ñâ„Ñß„Ñù")
      strProcessed.selfReplace("diu", "„Ñâ„Ñß„Ñ°")
      strProcessed.selfReplace("dou", "„Ñâ„Ñ°")
      strProcessed.selfReplace("dui", "„Ñâ„Ñ®„Ñü")
      strProcessed.selfReplace("dun", "„Ñâ„Ñ®„Ñ£")
      strProcessed.selfReplace("duo", "„Ñâ„Ñ®„Ñõ")
      strProcessed.selfReplace("eng", "„Ñ•")
      strProcessed.selfReplace("fan", "„Ñà„Ñ¢")
      strProcessed.selfReplace("fei", "„Ñà„Ñü")
      strProcessed.selfReplace("fen", "„Ñà„Ñ£")
      strProcessed.selfReplace("fou", "„Ñà„Ñ°")
      strProcessed.selfReplace("gai", "„Ñç„Ñû")
      strProcessed.selfReplace("gan", "„Ñç„Ñ¢")
      strProcessed.selfReplace("gao", "„Ñç„Ñ†")
      strProcessed.selfReplace("gei", "„Ñç„Ñü")
      strProcessed.selfReplace("gin", "„Ñç„Ñß„Ñ£")
      strProcessed.selfReplace("gen", "„Ñç„Ñ£")
      strProcessed.selfReplace("gou", "„Ñç„Ñ°")
      strProcessed.selfReplace("gua", "„Ñç„Ñ®„Ñö")
      strProcessed.selfReplace("gue", "„Ñç„Ñ®„Ñú")
      strProcessed.selfReplace("gui", "„Ñç„Ñ®„Ñü")
      strProcessed.selfReplace("gun", "„Ñç„Ñ®„Ñ£")
      strProcessed.selfReplace("guo", "„Ñç„Ñ®„Ñõ")
      strProcessed.selfReplace("hai", "„Ñè„Ñû")
      strProcessed.selfReplace("han", "„Ñè„Ñ¢")
      strProcessed.selfReplace("hao", "„Ñè„Ñ†")
      strProcessed.selfReplace("hei", "„Ñè„Ñü")
      strProcessed.selfReplace("hen", "„Ñè„Ñ£")
      strProcessed.selfReplace("hou", "„Ñè„Ñ°")
      strProcessed.selfReplace("hua", "„Ñè„Ñ®„Ñö")
      strProcessed.selfReplace("hui", "„Ñè„Ñ®„Ñü")
      strProcessed.selfReplace("hun", "„Ñè„Ñ®„Ñ£")
      strProcessed.selfReplace("huo", "„Ñè„Ñ®„Ñõ")
      strProcessed.selfReplace("jia", "„Ñê„Ñß„Ñö")
      strProcessed.selfReplace("jie", "„Ñê„Ñß„Ñù")
      strProcessed.selfReplace("jin", "„Ñê„Ñß„Ñ£")
      strProcessed.selfReplace("jiu", "„Ñê„Ñß„Ñ°")
      strProcessed.selfReplace("jue", "„Ñê„Ñ©„Ñù")
      strProcessed.selfReplace("kai", "„Ñé„Ñû")
      strProcessed.selfReplace("kan", "„Ñé„Ñ¢")
      strProcessed.selfReplace("kao", "„Ñé„Ñ†")
      strProcessed.selfReplace("ken", "„Ñé„Ñ£")
      strProcessed.selfReplace("kiu", "„Ñé„Ñß„Ñ°")
      strProcessed.selfReplace("kou", "„Ñé„Ñ°")
      strProcessed.selfReplace("kua", "„Ñé„Ñ®„Ñö")
      strProcessed.selfReplace("kui", "„Ñé„Ñ®„Ñü")
      strProcessed.selfReplace("kun", "„Ñé„Ñ®„Ñ£")
      strProcessed.selfReplace("kuo", "„Ñé„Ñ®„Ñõ")
      strProcessed.selfReplace("lai", "„Ñå„Ñû")
      strProcessed.selfReplace("lan", "„Ñå„Ñ¢")
      strProcessed.selfReplace("lao", "„Ñå„Ñ†")
      strProcessed.selfReplace("lei", "„Ñå„Ñü")
      strProcessed.selfReplace("lia", "„Ñå„Ñß„Ñö")
      strProcessed.selfReplace("lie", "„Ñå„Ñß„Ñù")
      strProcessed.selfReplace("lin", "„Ñå„Ñß„Ñ£")
      strProcessed.selfReplace("liu", "„Ñå„Ñß„Ñ°")
      strProcessed.selfReplace("lou", "„Ñå„Ñ°")
      strProcessed.selfReplace("lun", "„Ñå„Ñ®„Ñ£")
      strProcessed.selfReplace("luo", "„Ñå„Ñ®„Ñõ")
      strProcessed.selfReplace("lve", "„Ñå„Ñ©„Ñù")
      strProcessed.selfReplace("mai", "„Ñá„Ñû")
      strProcessed.selfReplace("man", "„Ñá„Ñ¢")
      strProcessed.selfReplace("mao", "„Ñá„Ñ†")
      strProcessed.selfReplace("mei", "„Ñá„Ñü")
      strProcessed.selfReplace("men", "„Ñá„Ñ£")
      strProcessed.selfReplace("mie", "„Ñá„Ñß„Ñù")
      strProcessed.selfReplace("min", "„Ñá„Ñß„Ñ£")
      strProcessed.selfReplace("miu", "„Ñá„Ñß„Ñ°")
      strProcessed.selfReplace("mou", "„Ñá„Ñ°")
      strProcessed.selfReplace("nai", "„Ñã„Ñû")
      strProcessed.selfReplace("nan", "„Ñã„Ñ¢")
      strProcessed.selfReplace("nao", "„Ñã„Ñ†")
      strProcessed.selfReplace("nei", "„Ñã„Ñü")
      strProcessed.selfReplace("nen", "„Ñã„Ñ£")
      strProcessed.selfReplace("nie", "„Ñã„Ñß„Ñù")
      strProcessed.selfReplace("nin", "„Ñã„Ñß„Ñ£")
      strProcessed.selfReplace("niu", "„Ñã„Ñß„Ñ°")
      strProcessed.selfReplace("nou", "„Ñã„Ñ°")
      strProcessed.selfReplace("nui", "„Ñã„Ñ®„Ñü")
      strProcessed.selfReplace("nun", "„Ñã„Ñ®„Ñ£")
      strProcessed.selfReplace("nuo", "„Ñã„Ñ®„Ñõ")
      strProcessed.selfReplace("nve", "„Ñã„Ñ©„Ñù")
      strProcessed.selfReplace("pai", "„ÑÜ„Ñû")
      strProcessed.selfReplace("pan", "„ÑÜ„Ñ¢")
      strProcessed.selfReplace("pao", "„ÑÜ„Ñ†")
      strProcessed.selfReplace("pei", "„ÑÜ„Ñü")
      strProcessed.selfReplace("pen", "„ÑÜ„Ñ£")
      strProcessed.selfReplace("pia", "„ÑÜ„Ñß„Ñö")
      strProcessed.selfReplace("pie", "„ÑÜ„Ñß„Ñù")
      strProcessed.selfReplace("pin", "„ÑÜ„Ñß„Ñ£")
      strProcessed.selfReplace("pou", "„ÑÜ„Ñ°")
      strProcessed.selfReplace("qia", "„Ñë„Ñß„Ñö")
      strProcessed.selfReplace("qie", "„Ñë„Ñß„Ñù")
      strProcessed.selfReplace("qin", "„Ñë„Ñß„Ñ£")
      strProcessed.selfReplace("qiu", "„Ñë„Ñß„Ñ°")
      strProcessed.selfReplace("que", "„Ñë„Ñ©„Ñù")
      strProcessed.selfReplace("qun", "„Ñë„Ñ©„Ñ£")
      strProcessed.selfReplace("ran", "„Ññ„Ñ¢")
      strProcessed.selfReplace("rao", "„Ññ„Ñ†")
      strProcessed.selfReplace("ren", "„Ññ„Ñ£")
      strProcessed.selfReplace("rou", "„Ññ„Ñ°")
      strProcessed.selfReplace("rui", "„Ññ„Ñ®„Ñü")
      strProcessed.selfReplace("run", "„Ññ„Ñ®„Ñ£")
      strProcessed.selfReplace("ruo", "„Ññ„Ñ®„Ñõ")
      strProcessed.selfReplace("sai", "„Ñô„Ñû")
      strProcessed.selfReplace("san", "„Ñô„Ñ¢")
      strProcessed.selfReplace("sao", "„Ñô„Ñ†")
      strProcessed.selfReplace("sei", "„Ñô„Ñü")
      strProcessed.selfReplace("sen", "„Ñô„Ñ£")
      strProcessed.selfReplace("sha", "„Ñï„Ñö")
      strProcessed.selfReplace("she", "„Ñï„Ñú")
      strProcessed.selfReplace("shi", "„Ñï")
      strProcessed.selfReplace("shu", "„Ñï„Ñ®")
      strProcessed.selfReplace("sou", "„Ñô„Ñ°")
      strProcessed.selfReplace("sui", "„Ñô„Ñ®„Ñü")
      strProcessed.selfReplace("sun", "„Ñô„Ñ®„Ñ£")
      strProcessed.selfReplace("suo", "„Ñô„Ñ®„Ñõ")
      strProcessed.selfReplace("tai", "„Ñä„Ñû")
      strProcessed.selfReplace("tan", "„Ñä„Ñ¢")
      strProcessed.selfReplace("tao", "„Ñä„Ñ†")
      strProcessed.selfReplace("tie", "„Ñä„Ñß„Ñù")
      strProcessed.selfReplace("tou", "„Ñä„Ñ°")
      strProcessed.selfReplace("tui", "„Ñä„Ñ®„Ñü")
      strProcessed.selfReplace("tun", "„Ñä„Ñ®„Ñ£")
      strProcessed.selfReplace("tuo", "„Ñä„Ñ®„Ñõ")
      strProcessed.selfReplace("wai", "„Ñ®„Ñû")
      strProcessed.selfReplace("wan", "„Ñ®„Ñ¢")
      strProcessed.selfReplace("wei", "„Ñ®„Ñü")
      strProcessed.selfReplace("wen", "„Ñ®„Ñ£")
      strProcessed.selfReplace("xia", "„Ñí„Ñß„Ñö")
      strProcessed.selfReplace("xie", "„Ñí„Ñß„Ñù")
      strProcessed.selfReplace("xin", "„Ñí„Ñß„Ñ£")
      strProcessed.selfReplace("xiu", "„Ñí„Ñß„Ñ°")
      strProcessed.selfReplace("xue", "„Ñí„Ñ©„Ñù")
      strProcessed.selfReplace("xun", "„Ñí„Ñ©„Ñ£")
      strProcessed.selfReplace("yai", "„Ñß„Ñû")
      strProcessed.selfReplace("yan", "„Ñß„Ñ¢")
      strProcessed.selfReplace("yao", "„Ñß„Ñ†")
      strProcessed.selfReplace("yin", "„Ñß„Ñ£")
      strProcessed.selfReplace("you", "„Ñß„Ñ°")
      strProcessed.selfReplace("yue", "„Ñ©„Ñù")
      strProcessed.selfReplace("yun", "„Ñ©„Ñ£")
      strProcessed.selfReplace("zai", "„Ñó„Ñû")
      strProcessed.selfReplace("zan", "„Ñó„Ñ¢")
      strProcessed.selfReplace("zao", "„Ñó„Ñ†")
      strProcessed.selfReplace("zei", "„Ñó„Ñü")
      strProcessed.selfReplace("zen", "„Ñó„Ñ£")
      strProcessed.selfReplace("zha", "„Ñì„Ñö")
      strProcessed.selfReplace("zhe", "„Ñì„Ñú")
      strProcessed.selfReplace("zhi", "„Ñì")
      strProcessed.selfReplace("zhu", "„Ñì„Ñ®")
      strProcessed.selfReplace("zou", "„Ñó„Ñ°")
      strProcessed.selfReplace("zui", "„Ñó„Ñ®„Ñü")
      strProcessed.selfReplace("zun", "„Ñó„Ñ®„Ñ£")
      strProcessed.selfReplace("zuo", "„Ñó„Ñ®„Ñõ")
      strProcessed.selfReplace("ai", "„Ñû")
      strProcessed.selfReplace("an", "„Ñ¢")
      strProcessed.selfReplace("ao", "„Ñ†")
      strProcessed.selfReplace("ba", "„ÑÖ„Ñö")
      strProcessed.selfReplace("bi", "„ÑÖ„Ñß")
      strProcessed.selfReplace("bo", "„ÑÖ„Ñõ")
      strProcessed.selfReplace("bu", "„ÑÖ„Ñ®")
      strProcessed.selfReplace("ca", "„Ñò„Ñö")
      strProcessed.selfReplace("ce", "„Ñò„Ñú")
      strProcessed.selfReplace("ci", "„Ñò")
      strProcessed.selfReplace("cu", "„Ñò„Ñ®")
      strProcessed.selfReplace("da", "„Ñâ„Ñö")
      strProcessed.selfReplace("de", "„Ñâ„Ñú")
      strProcessed.selfReplace("di", "„Ñâ„Ñß")
      strProcessed.selfReplace("du", "„Ñâ„Ñ®")
      strProcessed.selfReplace("eh", "„Ñù")
      strProcessed.selfReplace("ei", "„Ñü")
      strProcessed.selfReplace("en", "„Ñ£")
      strProcessed.selfReplace("er", "„Ñ¶")
      strProcessed.selfReplace("fa", "„Ñà„Ñö")
      strProcessed.selfReplace("fo", "„Ñà„Ñõ")
      strProcessed.selfReplace("fu", "„Ñà„Ñ®")
      strProcessed.selfReplace("ga", "„Ñç„Ñö")
      strProcessed.selfReplace("ge", "„Ñç„Ñú")
      strProcessed.selfReplace("gi", "„Ñç„Ñß")
      strProcessed.selfReplace("gu", "„Ñç„Ñ®")
      strProcessed.selfReplace("ha", "„Ñè„Ñö")
      strProcessed.selfReplace("he", "„Ñè„Ñú")
      strProcessed.selfReplace("hu", "„Ñè„Ñ®")
      strProcessed.selfReplace("ji", "„Ñê„Ñß")
      strProcessed.selfReplace("ju", "„Ñê„Ñ©")
      strProcessed.selfReplace("ka", "„Ñé„Ñö")
      strProcessed.selfReplace("ke", "„Ñé„Ñú")
      strProcessed.selfReplace("ku", "„Ñé„Ñ®")
      strProcessed.selfReplace("la", "„Ñå„Ñö")
      strProcessed.selfReplace("le", "„Ñå„Ñú")
      strProcessed.selfReplace("li", "„Ñå„Ñß")
      strProcessed.selfReplace("lo", "„Ñå„Ñõ")
      strProcessed.selfReplace("lu", "„Ñå„Ñ®")
      strProcessed.selfReplace("lv", "„Ñå„Ñ©")
      strProcessed.selfReplace("ma", "„Ñá„Ñö")
      strProcessed.selfReplace("me", "„Ñá„Ñú")
      strProcessed.selfReplace("mi", "„Ñá„Ñß")
      strProcessed.selfReplace("mo", "„Ñá„Ñõ")
      strProcessed.selfReplace("mu", "„Ñá„Ñ®")
      strProcessed.selfReplace("na", "„Ñã„Ñö")
      strProcessed.selfReplace("ne", "„Ñã„Ñú")
      strProcessed.selfReplace("ni", "„Ñã„Ñß")
      strProcessed.selfReplace("nu", "„Ñã„Ñ®")
      strProcessed.selfReplace("nv", "„Ñã„Ñ©")
      strProcessed.selfReplace("ou", "„Ñ°")
      strProcessed.selfReplace("pa", "„ÑÜ„Ñö")
      strProcessed.selfReplace("pi", "„ÑÜ„Ñß")
      strProcessed.selfReplace("po", "„ÑÜ„Ñõ")
      strProcessed.selfReplace("pu", "„ÑÜ„Ñ®")
      strProcessed.selfReplace("qi", "„Ñë„Ñß")
      strProcessed.selfReplace("qu", "„Ñë„Ñ©")
      strProcessed.selfReplace("re", "„Ññ„Ñú")
      strProcessed.selfReplace("ri", "„Ññ")
      strProcessed.selfReplace("ru", "„Ññ„Ñ®")
      strProcessed.selfReplace("sa", "„Ñô„Ñö")
      strProcessed.selfReplace("se", "„Ñô„Ñú")
      strProcessed.selfReplace("si", "„Ñô")
      strProcessed.selfReplace("su", "„Ñô„Ñ®")
      strProcessed.selfReplace("ta", "„Ñä„Ñö")
      strProcessed.selfReplace("te", "„Ñä„Ñú")
      strProcessed.selfReplace("ti", "„Ñä„Ñß")
      strProcessed.selfReplace("tu", "„Ñä„Ñ®")
      strProcessed.selfReplace("wa", "„Ñ®„Ñö")
      strProcessed.selfReplace("wo", "„Ñ®„Ñõ")
      strProcessed.selfReplace("wu", "„Ñ®")
      strProcessed.selfReplace("xi", "„Ñí„Ñß")
      strProcessed.selfReplace("xu", "„Ñí„Ñ©")
      strProcessed.selfReplace("ya", "„Ñß„Ñö")
      strProcessed.selfReplace("ye", "„Ñß„Ñù")
      strProcessed.selfReplace("yi", "„Ñß")
      strProcessed.selfReplace("yo", "„Ñß„Ñõ")
      strProcessed.selfReplace("yu", "„Ñ©")
      strProcessed.selfReplace("za", "„Ñó„Ñö")
      strProcessed.selfReplace("ze", "„Ñó„Ñú")
      strProcessed.selfReplace("zi", "„Ñó")
      strProcessed.selfReplace("zu", "„Ñó„Ñ®")
      strProcessed.selfReplace("a", "„Ñö")
      strProcessed.selfReplace("e", "„Ñú")
      strProcessed.selfReplace("o", "„Ñõ")
      strProcessed.selfReplace("q", "„Ñë")
      strProcessed.selfReplace("2", "Àä")
      strProcessed.selfReplace("3", "Àá")
      strProcessed.selfReplace("4", "Àã")
      strProcessed.selfReplace("5", "Àô")
      strProcessed.selfReplace("1", "")
    }

    // Step 3: Add Formatted Pragma, the Sorted Header:
    let hdrFormatted = "# ùôµùôæùöÅùôºùô∞ùöÉ ùöòùöõùöê.ùöäùöùùöéùöïùöíùöéùöõùô∏ùöóùöñùöû.ùöüùöåùöëùöéùö†ùöíùöóùöê.ùöûùöúùöéùöõùôªùöäùöóùöêùöûùöäùöêùöéùôºùöòùöçùöéùöïùô≥ùöäùöùùöä.ùöèùöòùöõùöñùöäùöùùöùùöéùöç\n"
    strProcessed = hdrFormatted + strProcessed  // Add Sorted Header

    // Step 4: Deduplication.
    let arrData = strProcessed.split(separator: "\n")
    // ‰∏ãÈù¢ÂÖ©Ë°åÁöÑ reversed ÊòØÈ¶ñÂ∞æÈ°õÂÄíÔºåÂÖçÂæóÁ†¥Â£ûÊúÄÊñ∞ÁöÑ override Ë≥áË®ä„ÄÇ
    let arrDataDeduplicated = Array(NSOrderedSet(array: arrData.reversed()).array as! [String])
    strProcessed = arrDataDeduplicated.reversed().joined(separator: "\n") + "\n"

    // Step 5: Remove duplicated newlines at the end of the file.
    strProcessed.regReplace(pattern: "\\n+", replaceWith: "\n")

    // Step 6: Commit Formatted Contents.
    self = strProcessed
  }
}
