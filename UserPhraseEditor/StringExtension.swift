// Copyright (c) 2021 and onwards The vChewing Project (MIT-NTL License).
/*
Permission is hereby granted, free of charge, to any person obtaining a copy of
this software and associated documentation files (the "Software"), to deal in
the Software without restriction, including without limitation the rights to
use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished to do so,
subject to the following conditions:

1. The above copyright notice and this permission notice shall be included in
all copies or substantial portions of the Software.

2. No trademark license is granted to use the trade names, trademarks, service
marks, or product names of Contributor, except as required to fulfill notice
requirements above.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS
FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR
COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER
IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN
CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
*/

import Foundation

extension String {
	mutating func regReplace(pattern: String, replaceWith: String = "") {
		// Ref: https://stackoverflow.com/a/40993403/4162914 && https://stackoverflow.com/a/71291137/4162914
		do {
			let regex = try NSRegularExpression(
				pattern: pattern, options: [.caseInsensitive, .anchorsMatchLines])
			let range = NSRange(self.startIndex..., in: self)
			self = regex.stringByReplacingMatches(
				in: self, options: [], range: range, withTemplate: replaceWith)
		} catch { return }
	}
	mutating func selfReplace(_ strOf: String, _ strWith: String = "") {
		self = self.replacingOccurrences(of: strOf, with: strWith)
	}
	mutating func formatConsolidate(cnvHYPYtoBPMF: Bool) {
		// Step 1: Consolidating formats per line.
		var strProcessed = self
		// È†êËôïÁêÜÊ†ºÂºè
		strProcessed = strProcessed.replacingOccurrences(of: " #MACOS", with: "")  // ÂéªÊéâ macOS Ê®ôË®ò
		// CJKWhiteSpace (\x{3000}) to ASCII Space
		// NonBreakWhiteSpace (\x{A0}) to ASCII Space
		// Tab to ASCII Space
		// Áµ±Êï¥ÈÄ£Á∫åÁ©∫Ê†ºÁÇ∫‰∏ÄÂÄã ASCII Á©∫Ê†º
		strProcessed.regReplace(pattern: #"(¬†+|„ÄÄ+| +|\t+)+"#, replaceWith: " ")
		strProcessed.regReplace(pattern: #"(^ | $)"#, replaceWith: "")  // ÂéªÈô§Ë°åÂ∞æË°åÈ¶ñÁ©∫Ê†º
		strProcessed.regReplace(pattern: #"(\f+|\r+|\n+)+"#, replaceWith: "\n")  // CR & FF to LF, ‰∏îÂéªÈô§ÈáçË§áË°å
		if strProcessed.prefix(1) == " " {  // ÂéªÈô§Ê™îÊ°àÈñãÈ†≠Á©∫Ê†º
			strProcessed.removeFirst()
		}
		if strProcessed.suffix(1) == " " {  // ÂéªÈô§Ê™îÊ°àÁµêÂ∞æÁ©∫Ê†º
			strProcessed.removeLast()
		}
		var arrData = [""]
		if cnvHYPYtoBPMF {
			// Step 0: Convert HanyuPinyin to Bopomofo.
			arrData = strProcessed.components(separatedBy: "\n")
			strProcessed = ""  // Reset its value
			for lineData in arrData {
				var varLineData = lineData
				// Êº¢Ë™ûÊãºÈü≥ËΩâÊ≥®Èü≥ÔºåÂæóÂÖàÂæûÊúÄÈï∑ÁöÑÂèØËÉΩÁöÑÊãºÈü≥ÁµÑÂêàÈñãÂßãËΩâËµ∑Ôºå
				// ÈÄôÊ®£Á≠âËΩâÊèõÂà∞Êõ¥Áü≠ÁöÑÂèØËÉΩÁöÑÊº¢Ë™ûÊãºÈü≥ÁµÑÂêàÊôÇÂ∞±‰∏çÊúÉÂá∫ÈåØ„ÄÇ
				// ‰æùÊ≠§È°ûÊé®ÔºåËÅ≤Ë™øÊîæÂú®ÊúÄÂæå‰æÜËΩâÊèõ„ÄÇ
				varLineData.selfReplace("chuang", "„Ñî„Ñ®„Ñ§")
				varLineData.selfReplace("shuang", "„Ñï„Ñ®„Ñ§")
				varLineData.selfReplace("zhuang", "„Ñì„Ñ®„Ñ§")
				varLineData.selfReplace("chang", "„Ñî„Ñ§")
				varLineData.selfReplace("cheng", "„Ñî„Ñ•")
				varLineData.selfReplace("chong", "„Ñî„Ñ®„Ñ•")
				varLineData.selfReplace("chuai", "„Ñî„Ñ®„Ñû")
				varLineData.selfReplace("chuan", "„Ñî„Ñ®„Ñ¢")
				varLineData.selfReplace("guang", "„Ñç„Ñ®„Ñ§")
				varLineData.selfReplace("huang", "„Ñè„Ñ®„Ñ§")
				varLineData.selfReplace("jiang", "„Ñê„Ñß„Ñ§")
				varLineData.selfReplace("jiong", "„Ñê„Ñ©„Ñ•")
				varLineData.selfReplace("kuang", "„Ñé„Ñ®„Ñ§")
				varLineData.selfReplace("liang", "„Ñå„Ñß„Ñ§")
				varLineData.selfReplace("niang", "„Ñã„Ñß„Ñ§")
				varLineData.selfReplace("qiang", "„Ñë„Ñß„Ñ§")
				varLineData.selfReplace("qiong", "„Ñë„Ñ©„Ñ•")
				varLineData.selfReplace("shang", "„Ñï„Ñ§")
				varLineData.selfReplace("sheng", "„Ñï„Ñ•")
				varLineData.selfReplace("shuai", "„Ñï„Ñ®„Ñû")
				varLineData.selfReplace("shuan", "„Ñï„Ñ®„Ñ¢")
				varLineData.selfReplace("xiang", "„Ñí„Ñß„Ñ§")
				varLineData.selfReplace("xiong", "„Ñí„Ñ©„Ñ•")
				varLineData.selfReplace("zhang", "„Ñì„Ñ§")
				varLineData.selfReplace("zheng", "„Ñì„Ñ•")
				varLineData.selfReplace("zhong", "„Ñì„Ñ®„Ñ•")
				varLineData.selfReplace("zhuai", "„Ñì„Ñ®„Ñû")
				varLineData.selfReplace("zhuan", "„Ñì„Ñ®„Ñ¢")
				varLineData.selfReplace("bang", "„ÑÖ„Ñ§")
				varLineData.selfReplace("beng", "„ÑÖ„Ñ•")
				varLineData.selfReplace("bian", "„ÑÖ„Ñß„Ñ¢")
				varLineData.selfReplace("biao", "„ÑÖ„Ñß„Ñ†")
				varLineData.selfReplace("bing", "„ÑÖ„Ñß„Ñ•")
				varLineData.selfReplace("cang", "„Ñò„Ñ§")
				varLineData.selfReplace("ceng", "„Ñò„Ñ•")
				varLineData.selfReplace("chai", "„Ñî„Ñû")
				varLineData.selfReplace("chan", "„Ñî„Ñ¢")
				varLineData.selfReplace("chao", "„Ñî„Ñ†")
				varLineData.selfReplace("chen", "„Ñî„Ñ£")
				varLineData.selfReplace("chou", "„Ñî„Ñ°")
				varLineData.selfReplace("chua", "„Ñî„Ñ®„Ñö")
				varLineData.selfReplace("chui", "„Ñî„Ñ®„Ñü")
				varLineData.selfReplace("chun", "„Ñî„Ñ®„Ñ£")
				varLineData.selfReplace("chuo", "„Ñî„Ñ®„Ñõ")
				varLineData.selfReplace("cong", "„Ñò„Ñ®„Ñ•")
				varLineData.selfReplace("cuan", "„Ñò„Ñ®„Ñ¢")
				varLineData.selfReplace("dang", "„Ñâ„Ñ§")
				varLineData.selfReplace("deng", "„Ñâ„Ñ•")
				varLineData.selfReplace("dian", "„Ñâ„Ñß„Ñ¢")
				varLineData.selfReplace("diao", "„Ñâ„Ñß„Ñ†")
				varLineData.selfReplace("ding", "„Ñâ„Ñß„Ñ•")
				varLineData.selfReplace("dong", "„Ñâ„Ñ®„Ñ•")
				varLineData.selfReplace("duan", "„Ñâ„Ñ®„Ñ¢")
				varLineData.selfReplace("fang", "„Ñà„Ñ§")
				varLineData.selfReplace("feng", "„Ñà„Ñ•")
				varLineData.selfReplace("fiao", "„Ñà„Ñß„Ñ†")
				varLineData.selfReplace("fong", "„Ñà„Ñ®„Ñ•")
				varLineData.selfReplace("gang", "„Ñç„Ñ§")
				varLineData.selfReplace("geng", "„Ñç„Ñ•")
				varLineData.selfReplace("giao", "„Ñç„Ñß„Ñ†")
				varLineData.selfReplace("gong", "„Ñç„Ñ®„Ñ•")
				varLineData.selfReplace("guai", "„Ñç„Ñ®„Ñû")
				varLineData.selfReplace("guan", "„Ñç„Ñ®„Ñ¢")
				varLineData.selfReplace("hang", "„Ñè„Ñ§")
				varLineData.selfReplace("heng", "„Ñè„Ñ•")
				varLineData.selfReplace("hong", "„Ñè„Ñ®„Ñ•")
				varLineData.selfReplace("huai", "„Ñè„Ñ®„Ñû")
				varLineData.selfReplace("huan", "„Ñè„Ñ®„Ñ¢")
				varLineData.selfReplace("jian", "„Ñê„Ñß„Ñ¢")
				varLineData.selfReplace("jiao", "„Ñê„Ñß„Ñ†")
				varLineData.selfReplace("jing", "„Ñê„Ñß„Ñ•")
				varLineData.selfReplace("juan", "„Ñê„Ñ©„Ñ¢")
				varLineData.selfReplace("kang", "„Ñé„Ñ§")
				varLineData.selfReplace("keng", "„Ñé„Ñ•")
				varLineData.selfReplace("kong", "„Ñé„Ñ®„Ñ•")
				varLineData.selfReplace("kuai", "„Ñé„Ñ®„Ñû")
				varLineData.selfReplace("kuan", "„Ñé„Ñ®„Ñ¢")
				varLineData.selfReplace("lang", "„Ñå„Ñ§")
				varLineData.selfReplace("leng", "„Ñå„Ñ•")
				varLineData.selfReplace("lian", "„Ñå„Ñß„Ñ¢")
				varLineData.selfReplace("liao", "„Ñå„Ñß„Ñ†")
				varLineData.selfReplace("ling", "„Ñå„Ñß„Ñ•")
				varLineData.selfReplace("long", "„Ñå„Ñ®„Ñ•")
				varLineData.selfReplace("luan", "„Ñå„Ñ®„Ñ¢")
				varLineData.selfReplace("lvan", "„Ñå„Ñ©„Ñ¢")
				varLineData.selfReplace("mang", "„Ñá„Ñ§")
				varLineData.selfReplace("meng", "„Ñá„Ñ•")
				varLineData.selfReplace("mian", "„Ñá„Ñß„Ñ¢")
				varLineData.selfReplace("miao", "„Ñá„Ñß„Ñ†")
				varLineData.selfReplace("ming", "„Ñá„Ñß„Ñ•")
				varLineData.selfReplace("nang", "„Ñã„Ñ§")
				varLineData.selfReplace("neng", "„Ñã„Ñ•")
				varLineData.selfReplace("nian", "„Ñã„Ñß„Ñ¢")
				varLineData.selfReplace("niao", "„Ñã„Ñß„Ñ†")
				varLineData.selfReplace("ning", "„Ñã„Ñß„Ñ•")
				varLineData.selfReplace("nong", "„Ñã„Ñ®„Ñ•")
				varLineData.selfReplace("nuan", "„Ñã„Ñ®„Ñ¢")
				varLineData.selfReplace("pang", "„ÑÜ„Ñ§")
				varLineData.selfReplace("peng", "„ÑÜ„Ñ•")
				varLineData.selfReplace("pian", "„ÑÜ„Ñß„Ñ¢")
				varLineData.selfReplace("piao", "„ÑÜ„Ñß„Ñ†")
				varLineData.selfReplace("ping", "„ÑÜ„Ñß„Ñ•")
				varLineData.selfReplace("qian", "„Ñë„Ñß„Ñ¢")
				varLineData.selfReplace("qiao", "„Ñë„Ñß„Ñ†")
				varLineData.selfReplace("qing", "„Ñë„Ñß„Ñ•")
				varLineData.selfReplace("quan", "„Ñë„Ñ©„Ñ¢")
				varLineData.selfReplace("rang", "„Ññ„Ñ§")
				varLineData.selfReplace("reng", "„Ññ„Ñ•")
				varLineData.selfReplace("rong", "„Ññ„Ñ®„Ñ•")
				varLineData.selfReplace("ruan", "„Ññ„Ñ®„Ñ¢")
				varLineData.selfReplace("sang", "„Ñô„Ñ§")
				varLineData.selfReplace("seng", "„Ñô„Ñ•")
				varLineData.selfReplace("shai", "„Ñï„Ñû")
				varLineData.selfReplace("shan", "„Ñï„Ñ¢")
				varLineData.selfReplace("shao", "„Ñï„Ñ†")
				varLineData.selfReplace("shei", "„Ñï„Ñü")
				varLineData.selfReplace("shen", "„Ñï„Ñ£")
				varLineData.selfReplace("shou", "„Ñï„Ñ°")
				varLineData.selfReplace("shua", "„Ñï„Ñ®„Ñö")
				varLineData.selfReplace("shui", "„Ñï„Ñ®„Ñü")
				varLineData.selfReplace("shun", "„Ñï„Ñ®„Ñ£")
				varLineData.selfReplace("shuo", "„Ñï„Ñ®„Ñõ")
				varLineData.selfReplace("song", "„Ñô„Ñ®„Ñ•")
				varLineData.selfReplace("suan", "„Ñô„Ñ®„Ñ¢")
				varLineData.selfReplace("tang", "„Ñä„Ñ§")
				varLineData.selfReplace("teng", "„Ñä„Ñ•")
				varLineData.selfReplace("tian", "„Ñä„Ñß„Ñ¢")
				varLineData.selfReplace("tiao", "„Ñä„Ñß„Ñ†")
				varLineData.selfReplace("ting", "„Ñä„Ñß„Ñ•")
				varLineData.selfReplace("tong", "„Ñä„Ñ®„Ñ•")
				varLineData.selfReplace("tuan", "„Ñä„Ñ®„Ñ¢")
				varLineData.selfReplace("wang", "„Ñ®„Ñ§")
				varLineData.selfReplace("weng", "„Ñ®„Ñ•")
				varLineData.selfReplace("xian", "„Ñí„Ñß„Ñ¢")
				varLineData.selfReplace("xiao", "„Ñí„Ñß„Ñ†")
				varLineData.selfReplace("xing", "„Ñí„Ñß„Ñ•")
				varLineData.selfReplace("xuan", "„Ñí„Ñ©„Ñ¢")
				varLineData.selfReplace("yang", "„Ñß„Ñ§")
				varLineData.selfReplace("ying", "„Ñß„Ñ•")
				varLineData.selfReplace("yong", "„Ñ©„Ñ•")
				varLineData.selfReplace("yuan", "„Ñ©„Ñ¢")
				varLineData.selfReplace("zang", "„Ñó„Ñ§")
				varLineData.selfReplace("zeng", "„Ñó„Ñ•")
				varLineData.selfReplace("zhai", "„Ñì„Ñû")
				varLineData.selfReplace("zhan", "„Ñì„Ñ¢")
				varLineData.selfReplace("zhao", "„Ñì„Ñ†")
				varLineData.selfReplace("zhei", "„Ñì„Ñü")
				varLineData.selfReplace("zhen", "„Ñì„Ñ£")
				varLineData.selfReplace("zhou", "„Ñì„Ñ°")
				varLineData.selfReplace("zhua", "„Ñì„Ñ®„Ñö")
				varLineData.selfReplace("zhui", "„Ñì„Ñ®„Ñü")
				varLineData.selfReplace("zhun", "„Ñì„Ñ®„Ñ£")
				varLineData.selfReplace("zhuo", "„Ñì„Ñ®„Ñõ")
				varLineData.selfReplace("zong", "„Ñó„Ñ®„Ñ•")
				varLineData.selfReplace("zuan", "„Ñó„Ñ®„Ñ¢")
				varLineData.selfReplace("jun", "„Ñê„Ñ©„Ñ£")
				varLineData.selfReplace("ang", "„Ñ§")
				varLineData.selfReplace("bai", "„ÑÖ„Ñû")
				varLineData.selfReplace("ban", "„ÑÖ„Ñ¢")
				varLineData.selfReplace("bao", "„ÑÖ„Ñ†")
				varLineData.selfReplace("bei", "„ÑÖ„Ñü")
				varLineData.selfReplace("ben", "„ÑÖ„Ñ£")
				varLineData.selfReplace("bie", "„ÑÖ„Ñß„Ñù")
				varLineData.selfReplace("bin", "„ÑÖ„Ñß„Ñ£")
				varLineData.selfReplace("cai", "„Ñò„Ñû")
				varLineData.selfReplace("can", "„Ñò„Ñ¢")
				varLineData.selfReplace("cao", "„Ñò„Ñ†")
				varLineData.selfReplace("cei", "„Ñò„Ñü")
				varLineData.selfReplace("cen", "„Ñò„Ñ£")
				varLineData.selfReplace("cha", "„Ñî„Ñö")
				varLineData.selfReplace("che", "„Ñî„Ñú")
				varLineData.selfReplace("chi", "„Ñî")
				varLineData.selfReplace("chu", "„Ñî„Ñ®")
				varLineData.selfReplace("cou", "„Ñò„Ñ°")
				varLineData.selfReplace("cui", "„Ñò„Ñ®„Ñü")
				varLineData.selfReplace("cun", "„Ñò„Ñ®„Ñ£")
				varLineData.selfReplace("cuo", "„Ñò„Ñ®„Ñõ")
				varLineData.selfReplace("dai", "„Ñâ„Ñû")
				varLineData.selfReplace("dan", "„Ñâ„Ñ¢")
				varLineData.selfReplace("dao", "„Ñâ„Ñ†")
				varLineData.selfReplace("dei", "„Ñâ„Ñü")
				varLineData.selfReplace("den", "„Ñâ„Ñ£")
				varLineData.selfReplace("dia", "„Ñâ„Ñß„Ñö")
				varLineData.selfReplace("die", "„Ñâ„Ñß„Ñù")
				varLineData.selfReplace("diu", "„Ñâ„Ñß„Ñ°")
				varLineData.selfReplace("dou", "„Ñâ„Ñ°")
				varLineData.selfReplace("dui", "„Ñâ„Ñ®„Ñü")
				varLineData.selfReplace("dun", "„Ñâ„Ñ®„Ñ£")
				varLineData.selfReplace("duo", "„Ñâ„Ñ®„Ñõ")
				varLineData.selfReplace("eng", "„Ñ•")
				varLineData.selfReplace("fan", "„Ñà„Ñ¢")
				varLineData.selfReplace("fei", "„Ñà„Ñü")
				varLineData.selfReplace("fen", "„Ñà„Ñ£")
				varLineData.selfReplace("fou", "„Ñà„Ñ°")
				varLineData.selfReplace("gai", "„Ñç„Ñû")
				varLineData.selfReplace("gan", "„Ñç„Ñ¢")
				varLineData.selfReplace("gao", "„Ñç„Ñ†")
				varLineData.selfReplace("gei", "„Ñç„Ñü")
				varLineData.selfReplace("gin", "„Ñç„Ñß„Ñ£")
				varLineData.selfReplace("gen", "„Ñç„Ñ£")
				varLineData.selfReplace("gou", "„Ñç„Ñ°")
				varLineData.selfReplace("gua", "„Ñç„Ñ®„Ñö")
				varLineData.selfReplace("gue", "„Ñç„Ñ®„Ñú")
				varLineData.selfReplace("gui", "„Ñç„Ñ®„Ñü")
				varLineData.selfReplace("gun", "„Ñç„Ñ®„Ñ£")
				varLineData.selfReplace("guo", "„Ñç„Ñ®„Ñõ")
				varLineData.selfReplace("hai", "„Ñè„Ñû")
				varLineData.selfReplace("han", "„Ñè„Ñ¢")
				varLineData.selfReplace("hao", "„Ñè„Ñ†")
				varLineData.selfReplace("hei", "„Ñè„Ñü")
				varLineData.selfReplace("hen", "„Ñè„Ñ£")
				varLineData.selfReplace("hou", "„Ñè„Ñ°")
				varLineData.selfReplace("hua", "„Ñè„Ñ®„Ñö")
				varLineData.selfReplace("hui", "„Ñè„Ñ®„Ñü")
				varLineData.selfReplace("hun", "„Ñè„Ñ®„Ñ£")
				varLineData.selfReplace("huo", "„Ñè„Ñ®„Ñõ")
				varLineData.selfReplace("jia", "„Ñê„Ñß„Ñö")
				varLineData.selfReplace("jie", "„Ñê„Ñß„Ñù")
				varLineData.selfReplace("jin", "„Ñê„Ñß„Ñ£")
				varLineData.selfReplace("jiu", "„Ñê„Ñß„Ñ°")
				varLineData.selfReplace("jue", "„Ñê„Ñ©„Ñù")
				varLineData.selfReplace("kai", "„Ñé„Ñû")
				varLineData.selfReplace("kan", "„Ñé„Ñ¢")
				varLineData.selfReplace("kao", "„Ñé„Ñ†")
				varLineData.selfReplace("ken", "„Ñé„Ñ£")
				varLineData.selfReplace("kiu", "„Ñé„Ñß„Ñ°")
				varLineData.selfReplace("kou", "„Ñé„Ñ°")
				varLineData.selfReplace("kua", "„Ñé„Ñ®„Ñö")
				varLineData.selfReplace("kui", "„Ñé„Ñ®„Ñü")
				varLineData.selfReplace("kun", "„Ñé„Ñ®„Ñ£")
				varLineData.selfReplace("kuo", "„Ñé„Ñ®„Ñõ")
				varLineData.selfReplace("lai", "„Ñå„Ñû")
				varLineData.selfReplace("lan", "„Ñå„Ñ¢")
				varLineData.selfReplace("lao", "„Ñå„Ñ†")
				varLineData.selfReplace("lei", "„Ñå„Ñü")
				varLineData.selfReplace("lia", "„Ñå„Ñß„Ñö")
				varLineData.selfReplace("lie", "„Ñå„Ñß„Ñù")
				varLineData.selfReplace("lin", "„Ñå„Ñß„Ñ£")
				varLineData.selfReplace("liu", "„Ñå„Ñß„Ñ°")
				varLineData.selfReplace("lou", "„Ñå„Ñ°")
				varLineData.selfReplace("lun", "„Ñå„Ñ®„Ñ£")
				varLineData.selfReplace("luo", "„Ñå„Ñ®„Ñõ")
				varLineData.selfReplace("lve", "„Ñå„Ñ©„Ñù")
				varLineData.selfReplace("mai", "„Ñá„Ñû")
				varLineData.selfReplace("man", "„Ñá„Ñ¢")
				varLineData.selfReplace("mao", "„Ñá„Ñ†")
				varLineData.selfReplace("mei", "„Ñá„Ñü")
				varLineData.selfReplace("men", "„Ñá„Ñ£")
				varLineData.selfReplace("mie", "„Ñá„Ñß„Ñù")
				varLineData.selfReplace("min", "„Ñá„Ñß„Ñ£")
				varLineData.selfReplace("miu", "„Ñá„Ñß„Ñ°")
				varLineData.selfReplace("mou", "„Ñá„Ñ°")
				varLineData.selfReplace("nai", "„Ñã„Ñû")
				varLineData.selfReplace("nan", "„Ñã„Ñ¢")
				varLineData.selfReplace("nao", "„Ñã„Ñ†")
				varLineData.selfReplace("nei", "„Ñã„Ñü")
				varLineData.selfReplace("nen", "„Ñã„Ñ£")
				varLineData.selfReplace("nie", "„Ñã„Ñß„Ñù")
				varLineData.selfReplace("nin", "„Ñã„Ñß„Ñ£")
				varLineData.selfReplace("niu", "„Ñã„Ñß„Ñ°")
				varLineData.selfReplace("nou", "„Ñã„Ñ°")
				varLineData.selfReplace("nui", "„Ñã„Ñ®„Ñü")
				varLineData.selfReplace("nun", "„Ñã„Ñ®„Ñ£")
				varLineData.selfReplace("nuo", "„Ñã„Ñ®„Ñõ")
				varLineData.selfReplace("nve", "„Ñã„Ñ©„Ñù")
				varLineData.selfReplace("pai", "„ÑÜ„Ñû")
				varLineData.selfReplace("pan", "„ÑÜ„Ñ¢")
				varLineData.selfReplace("pao", "„ÑÜ„Ñ†")
				varLineData.selfReplace("pei", "„ÑÜ„Ñü")
				varLineData.selfReplace("pen", "„ÑÜ„Ñ£")
				varLineData.selfReplace("pia", "„ÑÜ„Ñß„Ñö")
				varLineData.selfReplace("pie", "„ÑÜ„Ñß„Ñù")
				varLineData.selfReplace("pin", "„ÑÜ„Ñß„Ñ£")
				varLineData.selfReplace("pou", "„ÑÜ„Ñ°")
				varLineData.selfReplace("qia", "„Ñë„Ñß„Ñö")
				varLineData.selfReplace("qie", "„Ñë„Ñß„Ñù")
				varLineData.selfReplace("qin", "„Ñë„Ñß„Ñ£")
				varLineData.selfReplace("qiu", "„Ñë„Ñß„Ñ°")
				varLineData.selfReplace("que", "„Ñë„Ñ©„Ñù")
				varLineData.selfReplace("qun", "„Ñë„Ñ©„Ñ£")
				varLineData.selfReplace("ran", "„Ññ„Ñ¢")
				varLineData.selfReplace("rao", "„Ññ„Ñ†")
				varLineData.selfReplace("ren", "„Ññ„Ñ£")
				varLineData.selfReplace("rou", "„Ññ„Ñ°")
				varLineData.selfReplace("rui", "„Ññ„Ñ®„Ñü")
				varLineData.selfReplace("run", "„Ññ„Ñ®„Ñ£")
				varLineData.selfReplace("ruo", "„Ññ„Ñ®„Ñõ")
				varLineData.selfReplace("sai", "„Ñô„Ñû")
				varLineData.selfReplace("san", "„Ñô„Ñ¢")
				varLineData.selfReplace("sao", "„Ñô„Ñ†")
				varLineData.selfReplace("sei", "„Ñô„Ñü")
				varLineData.selfReplace("sen", "„Ñô„Ñ£")
				varLineData.selfReplace("sha", "„Ñï„Ñö")
				varLineData.selfReplace("she", "„Ñï„Ñú")
				varLineData.selfReplace("shi", "„Ñï")
				varLineData.selfReplace("shu", "„Ñï„Ñ®")
				varLineData.selfReplace("sou", "„Ñô„Ñ°")
				varLineData.selfReplace("sui", "„Ñô„Ñ®„Ñü")
				varLineData.selfReplace("sun", "„Ñô„Ñ®„Ñ£")
				varLineData.selfReplace("suo", "„Ñô„Ñ®„Ñõ")
				varLineData.selfReplace("tai", "„Ñä„Ñû")
				varLineData.selfReplace("tan", "„Ñä„Ñ¢")
				varLineData.selfReplace("tao", "„Ñä„Ñ†")
				varLineData.selfReplace("tie", "„Ñä„Ñß„Ñù")
				varLineData.selfReplace("tou", "„Ñä„Ñ°")
				varLineData.selfReplace("tui", "„Ñä„Ñ®„Ñü")
				varLineData.selfReplace("tun", "„Ñä„Ñ®„Ñ£")
				varLineData.selfReplace("tuo", "„Ñä„Ñ®„Ñõ")
				varLineData.selfReplace("wai", "„Ñ®„Ñû")
				varLineData.selfReplace("wan", "„Ñ®„Ñ¢")
				varLineData.selfReplace("wei", "„Ñ®„Ñü")
				varLineData.selfReplace("wen", "„Ñ®„Ñ£")
				varLineData.selfReplace("xia", "„Ñí„Ñß„Ñö")
				varLineData.selfReplace("xie", "„Ñí„Ñß„Ñù")
				varLineData.selfReplace("xin", "„Ñí„Ñß„Ñ£")
				varLineData.selfReplace("xiu", "„Ñí„Ñß„Ñ°")
				varLineData.selfReplace("xue", "„Ñí„Ñ©„Ñù")
				varLineData.selfReplace("xun", "„Ñí„Ñ©„Ñ£")
				varLineData.selfReplace("yai", "„Ñß„Ñû")
				varLineData.selfReplace("yan", "„Ñß„Ñ¢")
				varLineData.selfReplace("yao", "„Ñß„Ñ†")
				varLineData.selfReplace("yin", "„Ñß„Ñ£")
				varLineData.selfReplace("you", "„Ñß„Ñ°")
				varLineData.selfReplace("yue", "„Ñ©„Ñù")
				varLineData.selfReplace("yun", "„Ñ©„Ñ£")
				varLineData.selfReplace("zai", "„Ñó„Ñû")
				varLineData.selfReplace("zan", "„Ñó„Ñ¢")
				varLineData.selfReplace("zao", "„Ñó„Ñ†")
				varLineData.selfReplace("zei", "„Ñó„Ñü")
				varLineData.selfReplace("zen", "„Ñó„Ñ£")
				varLineData.selfReplace("zha", "„Ñì„Ñö")
				varLineData.selfReplace("zhe", "„Ñì„Ñú")
				varLineData.selfReplace("zhi", "„Ñì")
				varLineData.selfReplace("zhu", "„Ñì„Ñ®")
				varLineData.selfReplace("zou", "„Ñó„Ñ°")
				varLineData.selfReplace("zui", "„Ñó„Ñ®„Ñü")
				varLineData.selfReplace("zun", "„Ñó„Ñ®„Ñ£")
				varLineData.selfReplace("zuo", "„Ñó„Ñ®„Ñõ")
				varLineData.selfReplace("ai", "„Ñû")
				varLineData.selfReplace("an", "„Ñ¢")
				varLineData.selfReplace("ao", "„Ñ†")
				varLineData.selfReplace("ba", "„ÑÖ„Ñö")
				varLineData.selfReplace("bi", "„ÑÖ„Ñß")
				varLineData.selfReplace("bo", "„ÑÖ„Ñõ")
				varLineData.selfReplace("bu", "„ÑÖ„Ñ®")
				varLineData.selfReplace("ca", "„Ñò„Ñö")
				varLineData.selfReplace("ce", "„Ñò„Ñú")
				varLineData.selfReplace("ci", "„Ñò")
				varLineData.selfReplace("cu", "„Ñò„Ñ®")
				varLineData.selfReplace("da", "„Ñâ„Ñö")
				varLineData.selfReplace("de", "„Ñâ„Ñú")
				varLineData.selfReplace("di", "„Ñâ„Ñß")
				varLineData.selfReplace("du", "„Ñâ„Ñ®")
				varLineData.selfReplace("eh", "„Ñù")
				varLineData.selfReplace("ei", "„Ñü")
				varLineData.selfReplace("en", "„Ñ£")
				varLineData.selfReplace("er", "„Ñ¶")
				varLineData.selfReplace("fa", "„Ñà„Ñö")
				varLineData.selfReplace("fo", "„Ñà„Ñõ")
				varLineData.selfReplace("fu", "„Ñà„Ñ®")
				varLineData.selfReplace("ga", "„Ñç„Ñö")
				varLineData.selfReplace("ge", "„Ñç„Ñú")
				varLineData.selfReplace("gi", "„Ñç„Ñß")
				varLineData.selfReplace("gu", "„Ñç„Ñ®")
				varLineData.selfReplace("ha", "„Ñè„Ñö")
				varLineData.selfReplace("he", "„Ñè„Ñú")
				varLineData.selfReplace("hu", "„Ñè„Ñ®")
				varLineData.selfReplace("ji", "„Ñê„Ñß")
				varLineData.selfReplace("ju", "„Ñê„Ñ©")
				varLineData.selfReplace("ka", "„Ñé„Ñö")
				varLineData.selfReplace("ke", "„Ñé„Ñú")
				varLineData.selfReplace("ku", "„Ñé„Ñ®")
				varLineData.selfReplace("la", "„Ñå„Ñö")
				varLineData.selfReplace("le", "„Ñå„Ñú")
				varLineData.selfReplace("li", "„Ñå„Ñß")
				varLineData.selfReplace("lo", "„Ñå„Ñõ")
				varLineData.selfReplace("lu", "„Ñå„Ñ®")
				varLineData.selfReplace("lv", "„Ñå„Ñ©")
				varLineData.selfReplace("ma", "„Ñá„Ñö")
				varLineData.selfReplace("me", "„Ñá„Ñú")
				varLineData.selfReplace("mi", "„Ñá„Ñß")
				varLineData.selfReplace("mo", "„Ñá„Ñõ")
				varLineData.selfReplace("mu", "„Ñá„Ñ®")
				varLineData.selfReplace("na", "„Ñã„Ñö")
				varLineData.selfReplace("ne", "„Ñã„Ñú")
				varLineData.selfReplace("ni", "„Ñã„Ñß")
				varLineData.selfReplace("nu", "„Ñã„Ñ®")
				varLineData.selfReplace("nv", "„Ñã„Ñ©")
				varLineData.selfReplace("ou", "„Ñ°")
				varLineData.selfReplace("pa", "„ÑÜ„Ñö")
				varLineData.selfReplace("pi", "„ÑÜ„Ñß")
				varLineData.selfReplace("po", "„ÑÜ„Ñõ")
				varLineData.selfReplace("pu", "„ÑÜ„Ñ®")
				varLineData.selfReplace("qi", "„Ñë„Ñß")
				varLineData.selfReplace("qu", "„Ñë„Ñ©")
				varLineData.selfReplace("re", "„Ññ„Ñú")
				varLineData.selfReplace("ri", "„Ññ")
				varLineData.selfReplace("ru", "„Ññ„Ñ®")
				varLineData.selfReplace("sa", "„Ñô„Ñö")
				varLineData.selfReplace("se", "„Ñô„Ñú")
				varLineData.selfReplace("si", "„Ñô")
				varLineData.selfReplace("su", "„Ñô„Ñ®")
				varLineData.selfReplace("ta", "„Ñä„Ñö")
				varLineData.selfReplace("te", "„Ñä„Ñú")
				varLineData.selfReplace("ti", "„Ñä„Ñß")
				varLineData.selfReplace("tu", "„Ñä„Ñ®")
				varLineData.selfReplace("wa", "„Ñ®„Ñö")
				varLineData.selfReplace("wo", "„Ñ®„Ñõ")
				varLineData.selfReplace("wu", "„Ñ®")
				varLineData.selfReplace("xi", "„Ñí„Ñß")
				varLineData.selfReplace("xu", "„Ñí„Ñ©")
				varLineData.selfReplace("ya", "„Ñß„Ñö")
				varLineData.selfReplace("ye", "„Ñß„Ñù")
				varLineData.selfReplace("yi", "„Ñß")
				varLineData.selfReplace("yo", "„Ñß„Ñõ")
				varLineData.selfReplace("yu", "„Ñ©")
				varLineData.selfReplace("za", "„Ñó„Ñö")
				varLineData.selfReplace("ze", "„Ñó„Ñú")
				varLineData.selfReplace("zi", "„Ñó")
				varLineData.selfReplace("zu", "„Ñó„Ñ®")
				varLineData.selfReplace("a", "„Ñö")
				varLineData.selfReplace("e", "„Ñú")
				varLineData.selfReplace("o", "„Ñõ")
				varLineData.selfReplace("q", "„Ñë")
				varLineData.selfReplace("2", "Àä")
				varLineData.selfReplace("3", "Àá")
				varLineData.selfReplace("4", "Àã")
				varLineData.selfReplace("5", "Àô")
				varLineData.selfReplace("1", "")
				strProcessed += varLineData
				strProcessed += "\n"
			}
		}

		// Step 3: Add Formatted Pragma, the Sorted Header:
		let hdrFormatted = "# ùôµùôæùöÅùôºùô∞ùöÉ ùöòùöõùöê.ùöäùöùùöéùöïùöíùöéùöõùô∏ùöóùöñùöû.ùöüùöåùöëùöéùö†ùöíùöóùöê.ùöûùöúùöéùöõùôªùöäùöóùöêùöûùöäùöêùöéùôºùöòùöçùöéùöïùô≥ùöäùöùùöä.ùöèùöòùöõùöñùöäùöùùöùùöéùöç\n"
		strProcessed = hdrFormatted + strProcessed  // Add Sorted Header

		// Step 4: Deduplication.
		arrData = strProcessed.components(separatedBy: "\n")
		strProcessed = ""  // Reset its value
		// ‰∏ãÈù¢ÂÖ©Ë°åÁöÑ reversed ÊòØÈ¶ñÂ∞æÈ°õÂÄíÔºåÂÖçÂæóÁ†¥Â£ûÊúÄÊñ∞ÁöÑ override Ë≥áË®ä„ÄÇ
		let arrDataDeduplicated = Array(NSOrderedSet(array: arrData.reversed()).array as! [String])
		for lineData in arrDataDeduplicated.reversed() {
			strProcessed += lineData
			strProcessed += "\n"
		}

		// Step 5: Remove duplicated newlines at the end of the file.
		strProcessed.regReplace(pattern: "\\n+", replaceWith: "\n")

		// Step 6: Commit Formatted Contents.
		self = strProcessed
	}
}
